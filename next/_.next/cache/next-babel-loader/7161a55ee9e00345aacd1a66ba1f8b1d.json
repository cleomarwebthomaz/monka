{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport { ButtonGroup, ListGroup, Form, Spinner, Row, Col, Image, Card, Button } from 'react-bootstrap';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useRouter } from 'next/router';\nimport { toast } from 'react-toastify';\nimport CheckoutComponent from './Checkout';\nimport currency from '../../utils/currency';\nimport { showCart, loadCart } from '../../store/actions/cart';\nimport { get, patch, httpDelete } from '../../services/http';\nimport './styles.scss';\n\nfunction CartComponent() {\n  var _useState = useState([]),\n      addresses = _useState[0],\n      setAddresses = _useState[1];\n\n  var _useState2 = useState({}),\n      addressSelected = _useState2[0],\n      setAddressSelected = _useState2[1];\n\n  var route = useRouter();\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return state.auth;\n  }),\n      isLogged = _useSelector.isLogged;\n\n  var _useSelector2 = useSelector(function (state) {\n    return state.cart;\n  }),\n      show = _useSelector2.show,\n      cart = _useSelector2.cart,\n      loading = _useSelector2.loading;\n\n  var _useState3 = useState(false),\n      openCheckout = _useState3[0],\n      setOpenCheckout = _useState3[1];\n\n  useEffect(function () {\n    function getAddresses() {\n      var result, addressDefault;\n      return _regeneratorRuntime.async(function getAddresses$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(get('/myAddress'));\n\n            case 2:\n              result = _context.sent;\n\n              if (!(result.length <= 0)) {\n                _context.next = 7;\n                break;\n              }\n\n              toast.warning('Adicione um endereÃ§o para continuar', {\n                position: toast.POSITION.BOTTOM_CENTER\n              });\n              dispatch(showCart(false));\n              return _context.abrupt(\"return\", route.push('/auth/access/register-address'));\n\n            case 7:\n              if (!addressSelected || !addressSelected.id) {\n                addressDefault = result.find(function (item) {\n                  return item.is_default;\n                });\n                setAddressSelected(addressDefault);\n              }\n\n              setAddresses(result);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    }\n\n    if (isLogged && show) getAddresses();\n  }, [isLogged, show]);\n\n  function deleteItem(cartProduct) {\n    return _regeneratorRuntime.async(function deleteItem$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(httpDelete(\"/cart/\".concat(cartProduct.cart_id, \"/product/\").concat(cartProduct.id)));\n\n          case 2:\n            dispatch(loadCart());\n\n          case 3:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    });\n  }\n\n  function setAddress(address) {\n    return _regeneratorRuntime.async(function setAddress$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setAddressSelected(address);\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(patch(\"/myAddress/set-default/\".concat(address.id), address));\n\n          case 3:\n            dispatch(loadCart());\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    });\n  }\n\n  function incrementQuantity(cartProduct) {\n    return _regeneratorRuntime.async(function incrementQuantity$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            cartProduct.quantity += 1;\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(patch(\"/cart/\".concat(cart.id, \"/product/\").concat(cartProduct.id), {\n              quantity: cartProduct.quantity\n            }));\n\n          case 3:\n            dispatch(loadCart());\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    });\n  }\n\n  function decrementQuantity(cartProduct) {\n    return _regeneratorRuntime.async(function decrementQuantity$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            cartProduct.quantity -= 1;\n\n            if (cartProduct.quantity <= 0) {\n              cartProduct.quantity = 1;\n            }\n\n            _context5.next = 4;\n            return _regeneratorRuntime.awrap(patch(\"/cart/\".concat(cart.id, \"/product/\").concat(cartProduct.id), {\n              quantity: cartProduct.quantity\n            }));\n\n          case 4:\n            dispatch(loadCart());\n\n          case 5:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    });\n  }\n\n  function deleteItem(cartProduct) {\n    return _regeneratorRuntime.async(function deleteItem$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.next = 2;\n            return _regeneratorRuntime.awrap(httpDelete(\"/cart/\".concat(cart.id, \"/product/\").concat(cartProduct.id)));\n\n          case 2:\n            dispatch(loadCart());\n\n          case 3:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    });\n  }\n\n  if (!show) return __jsx(\"div\", null);\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    onClick: function onClick() {\n      return dispatch(showCart(false));\n    },\n    className: \"cart-mask\"\n  }), __jsx(CheckoutComponent, {\n    show: openCheckout && cart.products.length > 0,\n    onHide: function onHide() {\n      return setOpenCheckout();\n    },\n    addressSelected: addressSelected,\n    addresses: addresses,\n    cart: cart,\n    cartLoading: loading\n  }), __jsx(\"div\", {\n    id: \"block-cart\",\n    className: \"shadow\"\n  }, __jsx(\"div\", {\n    className: \"cart-header p-2 d-flex align-items-center border-bottom shadow justify-content-between\"\n  }, __jsx(\"div\", {\n    className: \"d-flex align-items-center\"\n  }, __jsx(\"h4\", {\n    className: \"m-0 mr-1 text-light text-primary\"\n  }, \"Sua sacola\"), \"(\", cart.products.length, \") produto\", cart.products <= 1 ? '' : 's'), __jsx(\"button\", {\n    className: \"btn btn-light rounded-circle\",\n    onClick: function onClick() {\n      dispatch(showCart(false));\n    }\n  }, __jsx(\"i\", {\n    className: \"fas fa-times\"\n  }))), __jsx(\"div\", {\n    className: \"body p-4 border-bottom\"\n  }, cart.products.length <= 0 && __jsx(\"div\", {\n    className: \"text-center\"\n  }, __jsx(\"h1\", null, \"Sua sacola est\\xE1 vazia\"), __jsx(\"div\", {\n    className: \"mt-5 empty-icon\"\n  }, __jsx(\"i\", {\n    className: \"far fa-frown-open\"\n  }))), cart.products.map(function (cartProduct) {\n    return __jsx(Card, {\n      className: \"rounded position-relative mb-4 pt-1 pb-2 item border-0\",\n      key: cartProduct.id\n    }, __jsx(Row, {\n      key: cartProduct.id\n    }, __jsx(Col, {\n      xs: 4\n    }, __jsx(Image, {\n      src: cartProduct.product.image_url,\n      className: \"img-fluid\"\n    })), __jsx(Col, {\n      xs: 8\n    }, __jsx(\"h6\", {\n      className: \"text-primary mb-0 mt-3\"\n    }, cartProduct.product.name), __jsx(Row, null, __jsx(Col, null, __jsx(\"div\", null, __jsx(\"b\", {\n      className: \"group-name text-secondary mb-0\"\n    }, \"Tamanho\")), cartProduct.option && __jsx(\"div\", {\n      className: \"group-value\"\n    }, cartProduct.option.name)), __jsx(Col, {\n      sm: 6,\n      className: \"pr-5 mt-4 mt-sm-0\"\n    }, __jsx(\"div\", {\n      className: \"p-2 bg-light d-flex flex-column text-center block-quantity\"\n    }, __jsx(\"div\", null, __jsx(Button, {\n      className: \"btn-quantity border-0 left btn-sm rounded-circle\",\n      onClick: function onClick() {\n        decrementQuantity(cartProduct);\n      }\n    }, __jsx(\"i\", {\n      className: \"fas fa-minus-circle\"\n    })), __jsx(\"div\", {\n      className: \"quantity btn btn-sm border-sm pl-3 pr-3 rounded-0 text-dark\"\n    }, cartProduct.quantity || 1), __jsx(Button, {\n      className: \"btn-quantity border-0 right btn-sm rounded-circle\",\n      onClick: function onClick() {\n        incrementQuantity(cartProduct);\n      }\n    }, __jsx(\"i\", {\n      className: \"fas fa-plus-circle\"\n    }))), __jsx(\"div\", {\n      className: \"total_price text-success mt-1\"\n    }, __jsx(\"b\", null, currency(cartProduct.total_price)))))), __jsx(Row, {\n      className: \"p-0 groups\"\n    }, cartProduct.groups.map(function (group) {\n      return __jsx(Col, {\n        xs: 6,\n        key: group.id\n      }, __jsx(ListGroup, {\n        className: \"mb-2 list-groups\"\n      }, __jsx(ListGroup.Item, {\n        className: \"p-0 m-0 border-0 group-option\"\n      }, group.name), group.options.map(function (groupOption) {\n        return __jsx(ListGroup.Item, {\n          className: \"p-0 m-0 border-0 group-option-name\",\n          key: groupOption.id\n        }, \"- \", groupOption.option.name, \" +\", __jsx(\"span\", {\n          className: \"text-muted\"\n        }, currency(groupOption.option.price)));\n      })));\n    }))), __jsx(Button, {\n      variant: \"danger\",\n      size: \"sm\",\n      className: \"rounded-circle btn-trash\",\n      onClick: function onClick() {\n        deleteItem(cartProduct);\n      }\n    }, __jsx(\"i\", {\n      className: \"fas fa-trash\"\n    }))));\n  })), __jsx(\"div\", {\n    className: \"footer w-100 pt-3\"\n  }, __jsx(\"div\", {\n    className: \"addresses ml-3 mr-3 mb-4\"\n  }, addresses.map(function (address) {\n    return __jsx(Form.Group, {\n      key: address.id,\n      controlId: \"address-\".concat(address.id),\n      className: \"mb-0\"\n    }, __jsx(Form.Check, {\n      type: \"radio\",\n      value: address.id,\n      checked: addressSelected && addressSelected.id === address.id,\n      label: \"\\n                                    \".concat(address.street, \", \").concat(address.number, \" - \\n                                    \").concat(address.neighborhood.name, \" \\n                                \"),\n      onChange: function onChange() {\n        return setAddress(address);\n      }\n    }));\n  })), __jsx(ListGroup, {\n    className: \"shadow ml-3 mr-3 mb-4 border-0\"\n  }, __jsx(ListGroup.Item, {\n    className: \"d-flex justify-content-between\"\n  }, __jsx(\"div\", null, \"Total de Items\"), __jsx(\"div\", null, loading ? __jsx(Spinner, {\n    animation: \"border\"\n  }) : currency(cart.total_products))), __jsx(ListGroup.Item, {\n    className: \"d-flex justify-content-between\"\n  }, __jsx(\"div\", null, \"Taxa de Entrega\"), __jsx(\"div\", null, loading ? __jsx(Spinner, {\n    animation: \"border\"\n  }) : currency(cart.shipping))), __jsx(ListGroup.Item, {\n    className: \"d-flex justify-content-between\"\n  }, __jsx(\"div\", null, \"Valor total\"), __jsx(\"div\", null, loading ? __jsx(Spinner, {\n    animation: \"border\"\n  }) : currency(cart.total_price)))), __jsx(\"div\", {\n    className: \"d-flex flex-column\"\n  }, __jsx(ButtonGroup, null, __jsx(\"div\", {\n    className: \"btn btn-light btn-lg rounded-0\"\n  }, \"Total: \", currency(cart.total_price)), __jsx(\"button\", {\n    className: \"btn btn-success btn-lg rounded-0\",\n    onClick: function onClick() {\n      return setOpenCheckout(true);\n    },\n    disabled: cart.products.length <= 0\n  }, \"Finalizar Pedido\", __jsx(\"i\", {\n    className: \"fas fa-chevron-right\"\n  })))))));\n}\n\nexport default CartComponent;","map":null,"metadata":{},"sourceType":"module"}