{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Modal, Button, Image, ListGroup, Spinner, Form } from \"react-bootstrap\";\nimport { useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toast } from 'react-toastify';\nimport Carousel from './Carousel';\nimport ProductGroups from './Groups';\nimport LoginModal from '../../auth/Modal';\nimport currency from \"../../../utils/currency\";\nimport { post } from \"../../../services/http\";\nimport { loadCart, showCart } from \"../../../store/actions/cart\";\nexport default function (props) {\n  const {\n    show,\n    setShow,\n    setting\n  } = props;\n  const {\n    0: product,\n    1: setProduct\n  } = useState(props.product);\n  const {\n    0: quantity,\n    1: setQuantity\n  } = useState(props.product.quantity || 1);\n  const {\n    0: basePrice,\n    1: setBasePrice\n  } = useState(props.product.price);\n  const {\n    0: totalPrice,\n    1: setTotalPrice\n  } = useState(props.product.price);\n  const {\n    0: error,\n    1: setError\n  } = useState({});\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: showLoginModal,\n    1: setShowLoginModal\n  } = useState(false);\n  const {\n    0: showObservation,\n    1: setShowObservation\n  } = useState(false);\n  const {\n    0: observation,\n    1: setObservation\n  } = useState('');\n  const dispatch = useDispatch();\n  const {\n    isLogged\n  } = useSelector(state => state.auth);\n  useEffect(() => {\n    if (product.options) {\n      const selected = product.options.find(item => item.selected);\n\n      if (!selected) {\n        product.options[0].selected = true;\n        setBasePrice(product.options[0].price);\n      }\n    }\n  }, []);\n\n  function updateProductPrices(base) {\n    let total = 0;\n\n    if (base) {\n      setBasePrice(base);\n    } else {\n      base = basePrice;\n    }\n\n    if (product.groups.length > 0) {\n      for (let i in product.groups) {\n        const group = product.groups[i];\n\n        for (let key in group.options) {\n          const option = group.options[key];\n\n          if (option.quantity > 0) {\n            const totalOptionPrice = option.price * option.quantity;\n            total = total += totalOptionPrice;\n          }\n        }\n      }\n    }\n\n    const totalPrice = (base + total) * quantity;\n    setTotalPrice(totalPrice);\n  }\n\n  const handleClose = () => {\n    setShow(false);\n  };\n\n  useEffect(() => {\n    updateProductPrices();\n  }, [quantity, basePrice, product]);\n\n  function incrementQuantity() {\n    let newQuantity = quantity;\n    newQuantity = newQuantity += 1;\n    setQuantity(newQuantity);\n  }\n\n  function decrementQuantity() {\n    let newQuantity = quantity;\n    newQuantity = newQuantity -= 1;\n    if (newQuantity <= 0) newQuantity = 1;\n    setQuantity(newQuantity);\n  }\n\n  async function addCart(force = false) {\n    try {\n      if (setting.store_status.value !== \"1\") {\n        return;\n      }\n\n      if (!isLogged && !force) {\n        setShow(false);\n        return setShowLoginModal(true);\n      }\n\n      setLoading(true);\n      setError({});\n      await validateProductAddToCart().then(async e => {\n        const productData = {\n          product_id: product.id,\n          quantity,\n          observation\n        };\n        productData.product_option_id = product.options.find(item => item.selected).id;\n        const listOptions = [];\n        product.groups.map(group => {\n          const hasOptions = group.options.filter(op => op.quantity > 0).length;\n\n          if (hasOptions > 0) {\n            group.options.filter(option => option.quantity > 0).map(option => {\n              listOptions.push({\n                product_group_option_id: option.id,\n                product_group_id: option.product_group_id,\n                quantity: option.quantity\n              });\n            });\n            return productData.options;\n          }\n        });\n        productData.options = listOptions;\n        await post('/cart', productData);\n        toast.success('Produto adicionado ao carrinho de compras', {\n          position: toast.POSITION.BOTTOM_CENTER\n        });\n        dispatch(loadCart());\n        dispatch(showCart(true));\n        setShow(false);\n        setLoading(false);\n      }).catch(error => {\n        setError(error);\n        setLoading(false);\n        console.log(error);\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  async function validateProductAddToCart() {\n    return new Promise((resolve, reject) => {\n      if (product.groups && product.groups.length > 0) {\n        product.groups.map(group => {\n          if (group.options && group.options.length > 0) {\n            let countSelects = 0;\n            group.options.filter(item => item.quantity > 0).map(op => {\n              countSelects = countSelects += op.quantity;\n            });\n\n            if (countSelects < group.min) {\n              return reject({\n                group_id: group.id,\n                title: group.name,\n                message: group.rules\n              });\n            }\n          }\n        });\n      }\n\n      resolve(true);\n    });\n  }\n\n  return __jsx(React.Fragment, null, !isLogged && __jsx(LoginModal, {\n    showLogin: showLoginModal,\n    closeModal: () => {\n      setShowLoginModal(false);\n      setShow(true);\n    },\n    onSuccess: () => {\n      setShow(true);\n      addCart(true);\n    }\n  }), __jsx(Modal, {\n    show: showObservation,\n    onHide: handleClose,\n    animation: false,\n    size: \"md\",\n    className: \"modal-product-show\"\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    className: \"border-0\"\n  }, __jsx(\"h4\", null, \"Observa\\xE7\\xE3o\")), __jsx(Modal.Body, null, __jsx(Form.Group, null, __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: \"3\",\n    onChange: e => setObservation(e.target.value),\n    defaultValue: observation\n  }))), __jsx(Modal.Footer, {\n    className: \"d-flex justify-content-between align-items-center pt-0 pb-0 bg-success\"\n  }, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: () => {\n      setShowObservation(false);\n      setShow(true);\n    }\n  }, \"Cancelar\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: () => {\n      setShowObservation(false);\n      setShow(true);\n      addCart();\n    }\n  }, \"Continuar\"))), __jsx(Modal, {\n    show: show,\n    onHide: handleClose,\n    animation: false,\n    size: \"md\",\n    className: \"modal-product-show\"\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    className: \"border-0\"\n  }), __jsx(Modal.Body, {\n    className: \"modal-body-show\"\n  }, __jsx(Carousel, {\n    images: product.images,\n    imageDefault: product.image_url\n  }), __jsx(\"h3\", null, product.name), __jsx(\"p\", null, product.description), product.options && __jsx(ListGroup, {\n    className: \"options mt-4 mb-4\",\n    horizontal: true\n  }, product.options.map(option => __jsx(ListGroup.Item, {\n    key: option.id,\n    active: option.selected,\n    onClick: () => {\n      product.options.map(op => op.selected = false);\n      option.selected = true;\n      setBasePrice(option.price);\n    }\n  }, option.name))), __jsx(ProductGroups, {\n    product: product,\n    groups: product.groups,\n    error: error,\n    onChange: data => {\n      setProduct(() => _objectSpread({}, product, {}, data));\n    }\n  })), __jsx(Modal.Footer, {\n    className: \"d-flex justify-content-between align-items-center pt-0 pb-0 bg-success\"\n  }, __jsx(\"h5\", {\n    className: \"price text-white pt-1\"\n  }, currency(totalPrice)), __jsx(\"div\", {\n    className: \"d-flex\"\n  }, isLogged && __jsx(React.Fragment, null, __jsx(Button, {\n    className: \"btn-quantity border-0 left btn-sm\",\n    onClick: decrementQuantity\n  }, __jsx(\"i\", {\n    className: \"fas fa-minus-circle\"\n  })), __jsx(\"div\", {\n    className: \"quantity btn btn-sm border-sm pl-3 pr-3 rounded-0 text-white\"\n  }, quantity || 1), __jsx(Button, {\n    className: \"btn-quantity border-0 right btn-sm\",\n    onClick: incrementQuantity\n  }, __jsx(\"i\", {\n    className: \"fas fa-plus-circle\"\n  }))), setting.store_status.value === \"1\" && __jsx(Button, {\n    className: \"btn-quantity right btn-md ml-3 border-0 text-uppercase\",\n    disabled: loading,\n    onClick: () => {\n      setShowObservation(true);\n      setShow(false);\n    }\n  }, __jsx(\"i\", {\n    className: \"fas fa-shopping-cart\"\n  }), \" Pedir\", loading && __jsx(Spinner, {\n    animation: \"border\",\n    role: \"status\"\n  }, __jsx(\"span\", {\n    className: \"sr-only\"\n  }, \"Loading...\")))))));\n}","map":null,"metadata":{},"sourceType":"module"}