{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nvar _jsxFileName = \"/Users/webthomaz/Desktop/Desenvolvimento/m/monka/nps/monka-api/next/pages/order/[id]/index.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useEffect, useState } from 'react';\nimport Link from 'next/link';\nimport { Container, Table, Card, ListGroup, Alert, Button } from 'react-bootstrap';\nimport { withRouter } from 'next/router';\nimport { useDispatch } from 'react-redux';\nimport { toast } from 'react-toastify';\nimport PageTitle from '../../../components/PageTitle';\nimport Spinner from '../../../components/Spinner';\nimport Breadcrumb from '../../../components/Breadcrumb';\nimport ProductDetails from '../../../components/Pages/Order/productDetails';\nimport currency from '../../../utils/currency';\nimport { get, patch } from '../../../services/http';\nimport { addCrumb, clearCrumbs } from '../../../store/actions/breadcrumb';\n\nfunction OrderDetails(props) {\n  var _useState = useState({}),\n      order = _useState[0],\n      setOrder = _useState[1];\n\n  var _useState2 = useState({}),\n      orderViewSelected = _useState2[0],\n      setOrderViewSelected = _useState2[1];\n\n  var _useState3 = useState(true),\n      loading = _useState3[0],\n      setLoading = _useState3[1];\n\n  var _useState4 = useState(false),\n      loadingCancelable = _useState4[0],\n      setLoadingCancelable = _useState4[1];\n\n  var _useState5 = useState(true),\n      credit = _useState5[0],\n      setCredit = _useState5[1];\n\n  var dispatch = useDispatch();\n  useEffect(function () {\n    dispatch(clearCrumbs());\n    dispatch(addCrumb('Meus Pedidos', '/order'));\n    dispatch(addCrumb('Detalhes'));\n  }, []);\n\n  function getOrder(id) {\n    var data;\n    return _regeneratorRuntime.async(function getOrder$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            setLoading(true);\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(get(\"/order/\".concat(id)));\n\n          case 3:\n            data = _context.sent;\n            setOrder(data);\n            setLoading(false);\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    });\n  }\n\n  useEffect(function () {\n    if (props.router.query.id) {\n      getOrder(props.router.query.id);\n    }\n  }, [props.router.query.id]);\n  useEffect(function () {\n    function getCredit() {\n      var _credit;\n\n      return _regeneratorRuntime.async(function getCredit$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!props.router.query.credit) {\n                _context2.next = 5;\n                break;\n              }\n\n              _context2.next = 3;\n              return _regeneratorRuntime.awrap(get(\"/credit/\".concat(props.router.query.credit)));\n\n            case 3:\n              _credit = _context2.sent;\n              setCredit(_credit);\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      });\n    }\n\n    getCredit();\n  }, [props.router.query]);\n\n  function onCancel() {\n    return _regeneratorRuntime.async(function onCancel$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            setLoadingCancelable(true);\n            _context3.next = 4;\n            return _regeneratorRuntime.awrap(patch(\"/order/cancel/\".concat(order.id)));\n\n          case 4:\n            toast.success('Pedido cancelado com sucesso!', {\n              position: toast.POSITION.BOTTOM_CENTER\n            });\n            _context3.next = 7;\n            return _regeneratorRuntime.awrap(getOrder(order.id));\n\n          case 7:\n            _context3.next = 12;\n            break;\n\n          case 9:\n            _context3.prev = 9;\n            _context3.t0 = _context3[\"catch\"](0);\n            toast.error(_context3.t0.message, {\n              position: toast.POSITION.BOTTOM_CENTER\n            });\n\n          case 12:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 9]]);\n  }\n\n  return __jsx(React.Fragment, null, __jsx(ProductDetails, {\n    showDetails: orderViewSelected.id > 0,\n    cartProduct: orderViewSelected,\n    closeDetails: function closeDetails() {\n      return setOrderViewSelected({});\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }), __jsx(Container, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81\n    },\n    __self: this\n  }, __jsx(Breadcrumb, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  }), __jsx(PageTitle, {\n    title: loading ? 'Pedido' : \"Pedido #\".concat(order.id),\n    className: \"d-flex justify-content-between align-items-center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88\n    },\n    __self: this\n  }, __jsx(Link, {\n    href: \"/order\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }, __jsx(\"a\", {\n    className: \"btn btn-sm btn-primary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-chevron-left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }), \" Voltar\")))), loading && __jsx(Spinner, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }), credit && __jsx(Alert, {\n    variant: \"success\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99\n    },\n    __self: this\n  }, \"Parab\\xE9ns voc\\xEA ganhou \", currency(credit.value)), !loading && __jsx(React.Fragment, null, __jsx(Card, {\n    className: \"mb-4 mt-4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }, __jsx(Card.Header, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104\n    },\n    __self: this\n  }, \"Detalhes do Pedido\"), __jsx(Card.Body, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, __jsx(Alert, {\n    style: {\n      background: order.state.color,\n      color: '#fff'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, order.state.name, order.state.pending && __jsx(Spinner, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  })), __jsx(ListGroup, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }, __jsx(ListGroup.Item, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, __jsx(\"strong\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, \"Valor Total:\"), \" \", currency(order.total_price)), __jsx(ListGroup.Item, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, __jsx(\"strong\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, \"Quantidade de Produtos:\"), \" (\", order.cart.__meta__.products_count, \")\"), __jsx(ListGroup.Item, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113\n    },\n    __self: this\n  }, __jsx(\"strong\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113\n    },\n    __self: this\n  }, \"Data da Compra:\"), \" \", order.created_at)))), __jsx(Card, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, __jsx(Card.Header, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, \"Produtos\"), __jsx(Card.Body, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, __jsx(Table, {\n    striped: true,\n    bordered: true,\n    hover: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, __jsx(\"thead\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, __jsx(\"tr\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, __jsx(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, \"Produto\"), __jsx(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, \"Valor\"), __jsx(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, \"Quantidade\"), __jsx(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, \"Total\"), __jsx(\"th\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }))), __jsx(\"tbody\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }, order.cart.products.map(function (cartProduct) {\n    return __jsx(\"tr\", {\n      key: cartProduct.id,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    }, __jsx(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, cartProduct.product.name, __jsx(\"span\", {\n      className: \"text-muted\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }, cartProduct.option && cartProduct.option.name)), __jsx(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139\n      },\n      __self: this\n    }, currency(cartProduct.price_unity)), __jsx(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, cartProduct.quantity), __jsx(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141\n      },\n      __self: this\n    }, currency(cartProduct.total_price)), __jsx(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, __jsx(Button, {\n      size: \"sm\",\n      onClick: function onClick() {\n        return setOrderViewSelected(cartProduct);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }, __jsx(\"i\", {\n      className: \"fas fa-eye\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }))));\n  }))))), __jsx(\"div\", {\n    className: \"mt-5 mb-5 d-flex justify-content-between\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, __jsx(Link, {\n    href: \"/\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, __jsx(\"a\", {\n    className: \"btn btn-light\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-chevron-left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }), \"Continuar Comprando\")), order.state.cancelable === 1 && __jsx(\"button\", {\n    className: \"btn btn-danger\",\n    onClick: onCancel,\n    disabled: loadingCancelable,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-times mr-1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }), !loadingCancelable ? 'Cancelar Pedido' : 'Cancelando', loadingCancelable && __jsx(Spinner, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  })), __jsx(Link, {\n    href: \"/account\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174\n    },\n    __self: this\n  }, __jsx(\"a\", {\n    className: \"btn btn-primary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }, \"Ir para minha Conta\", __jsx(\"i\", {\n    className: \"fas fa-chevron-right\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177\n    },\n    __self: this\n  })))))));\n}\n\nexport default withRouter(OrderDetails);","map":{"version":3,"sources":["/Users/webthomaz/Desktop/Desenvolvimento/m/monka/nps/monka-api/next/pages/order/[id]/index.js"],"names":["useEffect","useState","Link","Container","Table","Card","ListGroup","Alert","Button","withRouter","useDispatch","toast","PageTitle","Spinner","Breadcrumb","ProductDetails","currency","get","patch","addCrumb","clearCrumbs","OrderDetails","props","order","setOrder","orderViewSelected","setOrderViewSelected","loading","setLoading","loadingCancelable","setLoadingCancelable","credit","setCredit","dispatch","getOrder","id","data","router","query","getCredit","onCancel","success","position","POSITION","BOTTOM_CENTER","error","message","value","background","state","color","name","pending","total_price","cart","__meta__","products_count","created_at","products","map","cartProduct","product","option","price_unity","quantity","cancelable"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\nimport Link from 'next/link';\nimport { Container, Table, Card, ListGroup, Alert, Button } from 'react-bootstrap';\nimport { withRouter } from 'next/router'\nimport { useDispatch } from 'react-redux';\nimport { toast } from 'react-toastify';\n\nimport PageTitle from '../../../components/PageTitle';\nimport Spinner from '../../../components/Spinner';\nimport Breadcrumb from '../../../components/Breadcrumb';\n\nimport ProductDetails from '../../../components/Pages/Order/productDetails';\n\nimport currency from '../../../utils/currency';\nimport { get, patch } from '../../../services/http';\nimport { addCrumb, clearCrumbs } from '../../../store/actions/breadcrumb';\n\nfunction OrderDetails(props) {\n  const [order, setOrder] = useState({});\n  const [orderViewSelected, setOrderViewSelected] = useState({});\n  const [loading, setLoading] = useState(true);\n  const [loadingCancelable, setLoadingCancelable] = useState(false);\n  const [credit, setCredit] = useState(true);\n  \n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(clearCrumbs());\n    dispatch(addCrumb('Meus Pedidos', '/order'));\n    dispatch(addCrumb('Detalhes'));\n  }, []);\n\n\n  async function getOrder(id) {\n      setLoading(true);\n      const data = await get(`/order/${id}`);\n      setOrder(data);\n      setLoading(false);\n  }\n  \n  useEffect(() => {\n      if (props.router.query.id) {\n          getOrder(props.router.query.id);\n      }\n\n  }, [props.router.query.id]);\n\n  useEffect(() => {\n    async function getCredit() {\n      if (props.router.query.credit) {\n          const credit = await get(`/credit/${props.router.query.credit}`);\n          setCredit(credit);\n      }\n    }\n\n    getCredit();\n  }, [props.router.query]);\n\n  async function onCancel() {\n    try {\n      setLoadingCancelable(true);\n\n      await patch(`/order/cancel/${order.id}`);\n      toast.success('Pedido cancelado com sucesso!', { position: toast.POSITION.BOTTOM_CENTER });\n\n      await getOrder(order.id);\n\n    } catch (error) {\n      toast.error(error.message, { position: toast.POSITION.BOTTOM_CENTER });\n    }\n  }\n\n  return (\n    <>\n      <ProductDetails \n        showDetails={orderViewSelected.id > 0}\n        cartProduct={orderViewSelected}\n        closeDetails={() => setOrderViewSelected({})}\n      />\n\n      <Container>\n          <Breadcrumb />\n\n          <PageTitle \n              title={loading ? 'Pedido' : `Pedido #${order.id}`} \n              className=\"d-flex justify-content-between align-items-center\"\n          >\n            <div>\n              <Link href=\"/order\">\n                  <a className=\"btn btn-sm btn-primary\">\n                    <i className=\"fas fa-chevron-left\"></i> Voltar\n                  </a>\n              </Link>\n            </div>\n          </PageTitle>\n\n          {loading && <Spinner /> }\n\n          {credit && <Alert variant=\"success\">Parabéns você ganhou {currency(credit.value)}</Alert>}\n\n          {!loading &&\n          <>\n            <Card className=\"mb-4 mt-4\">\n              <Card.Header>Detalhes do Pedido</Card.Header>\n              <Card.Body>\n                <Alert style={{ background: order.state.color, color: '#fff' }}>\n                    {order.state.name}\n                    {order.state.pending && <Spinner />}\n                </Alert>\n                <ListGroup>\n                    <ListGroup.Item><strong>Valor Total:</strong> {currency(order.total_price)}</ListGroup.Item>\n                    <ListGroup.Item><strong>Quantidade de Produtos:</strong> ({order.cart.__meta__.products_count})</ListGroup.Item>\n                    <ListGroup.Item><strong>Data da Compra:</strong> {order.created_at}</ListGroup.Item>\n                </ListGroup>\n              </Card.Body>\n            </Card>\n\n            <Card>\n              <Card.Header>Produtos</Card.Header>\n              <Card.Body>\n                \n              <Table striped bordered hover>\n                <thead>\n                  <tr>\n                    <th>Produto</th>\n                    <th>Valor</th>\n                    <th>Quantidade</th>\n                    <th>Total</th>\n                    <th></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {order.cart.products.map(cartProduct => \n                    <tr key={cartProduct.id}>\n                      <td>\n                        {cartProduct.product.name}\n                        <span className=\"text-muted\">{cartProduct.option && cartProduct.option.name}</span>\n                      </td>\n                      <td>{currency(cartProduct.price_unity)}</td>\n                      <td>{cartProduct.quantity}</td>\n                      <td>{currency(cartProduct.total_price)}</td>\n                      <td>\n                        <Button\n                          size=\"sm\"  \n                          onClick={() => setOrderViewSelected(cartProduct)}\n                        >\n                          <i className=\"fas fa-eye\"></i> \n                        </Button>\n                      </td>\n                    </tr>\n                  )}\n                </tbody>\n              </Table>\n\n              </Card.Body>\n            </Card>\n\n            <div className=\"mt-5 mb-5 d-flex justify-content-between\">\n                <Link href=\"/\">\n                  <a className=\"btn btn-light\">\n                    <i className=\"fas fa-chevron-left\"></i> \n                    Continuar Comprando  \n                  </a>\n                </Link>\n\n                {order.state.cancelable === 1 &&\n                  <button className=\"btn btn-danger\" onClick={onCancel} disabled={loadingCancelable}>\n                      <i className=\"fas fa-times mr-1\"></i> \n                      {!loadingCancelable ? 'Cancelar Pedido' : 'Cancelando'}\n                      {loadingCancelable && <Spinner />}\n                  </button>\n                }\n\n                <Link href=\"/account\">\n                  <a className=\"btn btn-primary\">\n                    Ir para minha Conta\n                    <i className=\"fas fa-chevron-right\"></i> \n                  </a>\n                </Link>\n              </div>\n\n            </>\n          }\n\n      </Container>  \n    </>\n  );\n\n}\n\nexport default withRouter(OrderDetails);"]},"metadata":{},"sourceType":"module"}