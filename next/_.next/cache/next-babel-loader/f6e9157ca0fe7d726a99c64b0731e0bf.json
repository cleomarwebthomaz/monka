{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nvar _jsxFileName = \"/Users/webthomaz/Desktop/Desenvolvimento/m/monka/api/next/pages/products/[slug]/index.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport { Container, Row, Col, Button, ListGroup, Spinner } from 'react-bootstrap';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { toast } from 'react-toastify';\nimport LoginModal from '../../auth/Modal';\nimport Page from '../../../components/Page';\nimport Loading from '../../../components/Loading';\nimport Breadcrumb from '../../../components/Breadcrumb';\nimport Carousel from './Carousel';\nimport ProductGroups from './components/Groups';\nimport { loadCart } from '../../../store/actions/cart';\nimport currency from '../../../utils/currency';\nimport { addCrumb, clearCrumbs } from '../../../store/actions/breadcrumb';\nimport { get, post } from '../../../services/http';\nimport './styles.scss';\nimport PageTitle from '../../../components/PageTitle';\n\nvar ProductShow = function ProductShow(props) {\n  var _useState = useState(props.product),\n      product = _useState[0],\n      setProduct = _useState[1];\n\n  var _useState2 = useState(props.product.quantity || 1),\n      quantity = _useState2[0],\n      setQuantity = _useState2[1];\n\n  var _useState3 = useState(props.basePrice),\n      basePrice = _useState3[0],\n      setBasePrice = _useState3[1];\n\n  var _useState4 = useState(props.basePrice),\n      totalPrice = _useState4[0],\n      setTotalPrice = _useState4[1];\n\n  var _useState5 = useState({}),\n      error = _useState5[0],\n      setError = _useState5[1];\n\n  var _useState6 = useState(false),\n      loading = _useState6[0],\n      setLoading = _useState6[1];\n\n  var _useState7 = useState(false),\n      showLoginModal = _useState7[0],\n      setShowLoginModal = _useState7[1];\n\n  var _useSelector = useSelector(function (state) {\n    return state.auth;\n  }),\n      isLogged = _useSelector.isLogged;\n\n  var _useSelector2 = useSelector(function (state) {\n    return state.setting;\n  }),\n      setting = _useSelector2.setting,\n      loaded = _useSelector2.loaded;\n\n  var dispatch = useDispatch();\n  var router = useRouter();\n  useEffect(function () {\n    dispatch(clearCrumbs());\n    dispatch(addCrumb('Produtos', '/'));\n  }, []);\n  useEffect(function () {\n    updateProductPrices();\n  }, [quantity, basePrice, product]);\n\n  function incrementQuantity() {\n    var newQuantity = quantity;\n    newQuantity = newQuantity += 1;\n    setQuantity(newQuantity);\n  }\n\n  function decrementQuantity() {\n    var newQuantity = quantity;\n    newQuantity = newQuantity -= 1;\n    if (newQuantity <= 0) newQuantity = 1;\n    setQuantity(newQuantity);\n  }\n\n  function updateProductPrices(base) {\n    var total = 0;\n\n    if (base) {\n      setBasePrice(base);\n    } else {\n      base = basePrice;\n    }\n\n    if (product.groups.length > 0) {\n      for (var i in product.groups) {\n        var group = product.groups[i];\n\n        for (var key in group.options) {\n          var option = group.options[key];\n\n          if (option.quantity > 0) {\n            var totalOptionPrice = option.price * option.quantity;\n            total = total += totalOptionPrice;\n          }\n        }\n      }\n    }\n\n    var totalPrice = (base + total) * quantity;\n    setTotalPrice(totalPrice);\n  }\n\n  function validateProductAddToCart() {\n    return _regeneratorRuntime.async(function validateProductAddToCart$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", new _Promise(function (resolve, reject) {\n              if (product.groups && product.groups.length > 0) {\n                product.groups.map(function (group) {\n                  if (group.options && group.options.length > 0) {\n                    var countSelects = 0;\n                    group.options.filter(function (item) {\n                      return item.quantity > 0;\n                    }).map(function (op) {\n                      countSelects = countSelects += op.quantity;\n                    });\n\n                    if (countSelects < group.min) {\n                      return reject({\n                        group_id: group.id,\n                        title: group.name,\n                        message: group.rules\n                      });\n                    }\n                  }\n                });\n              }\n\n              resolve(true);\n            }));\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    });\n  }\n\n  function addCart() {\n    var force,\n        _args3 = arguments;\n    return _regeneratorRuntime.async(function addCart$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            force = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : false;\n            _context3.prev = 1;\n\n            if (!(setting.store_status.value !== \"1\")) {\n              _context3.next = 4;\n              break;\n            }\n\n            return _context3.abrupt(\"return\");\n\n          case 4:\n            if (!(!isLogged && !force)) {\n              _context3.next = 6;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", setShowLoginModal(true));\n\n          case 6:\n            setLoading(true);\n            setError({});\n            _context3.next = 10;\n            return _regeneratorRuntime.awrap(validateProductAddToCart().then(function _callee(e) {\n              var productData, listOptions;\n              return _regeneratorRuntime.async(function _callee$(_context2) {\n                while (1) {\n                  switch (_context2.prev = _context2.next) {\n                    case 0:\n                      productData = {\n                        product_id: product.id,\n                        quantity: quantity\n                      };\n                      productData.product_option_id = product.options.find(function (item) {\n                        return item.selected;\n                      }).id;\n                      listOptions = [];\n                      product.groups.map(function (group) {\n                        var hasOptions = group.options.filter(function (op) {\n                          return op.quantity > 0;\n                        }).length;\n\n                        if (hasOptions > 0) {\n                          group.options.filter(function (option) {\n                            return option.quantity > 0;\n                          }).map(function (option) {\n                            listOptions.push({\n                              product_group_option_id: option.id,\n                              product_group_id: option.product_group_id,\n                              quantity: option.quantity\n                            });\n                          });\n                          return productData.options;\n                        }\n                      });\n                      productData.options = listOptions;\n                      _context2.next = 7;\n                      return _regeneratorRuntime.awrap(post('/cart', productData));\n\n                    case 7:\n                      toast.success('Produto adicionado ao carrinho de compras', {\n                        position: toast.POSITION.BOTTOM_CENTER\n                      });\n                      dispatch(loadCart());\n                      router.push('/cart');\n\n                    case 10:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }\n              });\n            })[\"catch\"](function (error) {\n              setError(error);\n              setLoading(false);\n            }));\n\n          case 10:\n            _context3.next = 15;\n            break;\n\n          case 12:\n            _context3.prev = 12;\n            _context3.t0 = _context3[\"catch\"](1);\n            console.log(_context3.t0);\n\n          case 15:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[1, 12]]);\n  }\n\n  if (!loaded) return __jsx(Loading, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  });\n  return __jsx(Page, {\n    title: product.name,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }, __jsx(Container, {\n    className: \"mb-5 productShow\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }, __jsx(Breadcrumb, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }), !isLogged && __jsx(LoginModal, {\n    showLogin: showLoginModal,\n    closeModal: function closeModal() {\n      return setShowLoginModal(false);\n    },\n    onSuccess: function onSuccess() {\n      return addCart(true);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }), __jsx(Row, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184\n    },\n    __self: this\n  }, __jsx(Col, {\n    xs: 6,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, __jsx(Carousel, {\n    images: product.images,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186\n    },\n    __self: this\n  }), __jsx(\"h4\", {\n    className: \"mt-5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, \"Descri\\xE7\\xE3o\"), __jsx(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }, product.description)), __jsx(Col, {\n    className: \"pt-4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }, __jsx(PageTitle, {\n    className: \"name\",\n    title: product.name,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  }, product.name), __jsx(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194\n    },\n    __self: this\n  }, product.short_description), __jsx(\"h1\", {\n    className: \"price\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  }, currency(totalPrice)), product.options && __jsx(ListGroup, {\n    className: \"options mt-4\",\n    horizontal: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198\n    },\n    __self: this\n  }, product.options.map(function (option) {\n    return __jsx(ListGroup.Item, {\n      key: option.id,\n      active: option.selected,\n      onClick: function onClick() {\n        product.options.map(function (op) {\n          return op.selected = false;\n        });\n        option.selected = true;\n        setBasePrice(option.price);\n        setProduct(function () {\n          return _objectSpread({}, product, {}, product);\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }, option.name);\n  })), __jsx(ProductGroups, {\n    product: product,\n    groups: product.groups,\n    error: error,\n    onChange: function onChange(data) {\n      setProduct(function () {\n        return _objectSpread({}, product, {}, data);\n      });\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: \"d-flex mt-4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225\n    },\n    __self: this\n  }, __jsx(Button, {\n    className: \"btn-quantity left btn-md\",\n    onClick: decrementQuantity,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-minus-circle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: \"quantity btn btn-md bg-light border-sm pl-3 pr-3 rounded-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229\n    },\n    __self: this\n  }, quantity || 1), __jsx(Button, {\n    className: \"btn-quantity right btn-md\",\n    onClick: incrementQuantity,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-plus-circle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233\n    },\n    __self: this\n  })), setting.store_status.value === \"1\" && __jsx(Button, {\n    className: \"btn-quantity right btn-md ml-3\",\n    disabled: loading,\n    onClick: function onClick() {\n      return addCart();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-shopping-cart\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238\n    },\n    __self: this\n  }), \" Comprar\", loading && __jsx(Spinner, {\n    animation: \"border\",\n    role: \"status\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241\n    },\n    __self: this\n  }, __jsx(\"span\", {\n    className: \"sr-only\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242\n    },\n    __self: this\n  }, \"Loading...\"))))))));\n};\n\nProductShow.getInitialProps = function _callee2(_ref) {\n  var query, product, basePrice;\n  return _regeneratorRuntime.async(function _callee2$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          query = _ref.query;\n\n          if (query.slug) {\n            _context4.next = 3;\n            break;\n          }\n\n          return _context4.abrupt(\"return\", {\n            error: true,\n            product: {}\n          });\n\n        case 3:\n          _context4.next = 5;\n          return _regeneratorRuntime.awrap(get(\"/product/\".concat(query.slug)));\n\n        case 5:\n          product = _context4.sent;\n          basePrice = product.price;\n\n          if (product.options) {\n            basePrice = product.options[0].price;\n            product.options[0].selected = true;\n          }\n\n          return _context4.abrupt(\"return\", {\n            product: product,\n            basePrice: basePrice\n          });\n\n        case 9:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  });\n};\n\nexport default ProductShow;","map":{"version":3,"sources":["/Users/webthomaz/Desktop/Desenvolvimento/m/monka/api/next/pages/products/[slug]/index.js"],"names":["useEffect","useState","useRouter","Container","Row","Col","Button","ListGroup","Spinner","useDispatch","useSelector","toast","LoginModal","Page","Loading","Breadcrumb","Carousel","ProductGroups","loadCart","currency","addCrumb","clearCrumbs","get","post","PageTitle","ProductShow","props","product","setProduct","quantity","setQuantity","basePrice","setBasePrice","totalPrice","setTotalPrice","error","setError","loading","setLoading","showLoginModal","setShowLoginModal","state","auth","isLogged","setting","loaded","dispatch","router","updateProductPrices","incrementQuantity","newQuantity","decrementQuantity","base","total","groups","length","i","group","key","options","option","totalOptionPrice","price","validateProductAddToCart","resolve","reject","map","countSelects","filter","item","op","min","group_id","id","title","name","message","rules","addCart","force","store_status","value","then","e","productData","product_id","product_option_id","find","selected","listOptions","hasOptions","push","product_group_option_id","product_group_id","success","position","POSITION","BOTTOM_CENTER","console","log","images","description","short_description","data","getInitialProps","query","slug"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router'\nimport { Container, Row, Col, Button, ListGroup, Spinner } from 'react-bootstrap';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { toast } from 'react-toastify';\n\nimport LoginModal from '../../auth/Modal';\nimport Page from '../../../components/Page';\nimport Loading from '../../../components/Loading';\nimport Breadcrumb from '../../../components/Breadcrumb';\nimport Carousel from './Carousel';\n\nimport ProductGroups from './components/Groups';\n\nimport { loadCart } from '../../../store/actions/cart';\nimport currency from '../../../utils/currency';\nimport { addCrumb, clearCrumbs } from '../../../store/actions/breadcrumb';\nimport { get, post } from '../../../services/http';\n\nimport './styles.scss';\nimport PageTitle from '../../../components/PageTitle';\n\nconst ProductShow = (props) => {\n    const [product, setProduct] = useState(props.product);\n    const [quantity, setQuantity] = useState(props.product.quantity || 1);\n    const [basePrice, setBasePrice] = useState(props.basePrice);\n    const [totalPrice, setTotalPrice] = useState(props.basePrice);\n    const [error, setError] = useState({});\n    const [loading, setLoading] = useState(false);\n    const [showLoginModal, setShowLoginModal] = useState(false);\n\n    const { isLogged } = useSelector(state => state.auth);\n    const { setting, loaded } = useSelector(state => state.setting);\n    const dispatch = useDispatch();\n    const router = useRouter();\n\n    useEffect(() => {\n        dispatch(clearCrumbs());\n        dispatch(addCrumb('Produtos', '/'));\n    }, []);\n\n    useEffect(() => {\n        updateProductPrices();\n    }, [quantity, basePrice, product]);\n\n    function incrementQuantity() {\n        let newQuantity = quantity;\n        newQuantity = newQuantity += 1;\n        setQuantity(newQuantity);\n    }\n    \n    function decrementQuantity() {\n        let newQuantity = quantity;\n        newQuantity = newQuantity -= 1;\n        if (newQuantity <= 0) newQuantity = 1;\n        setQuantity(newQuantity);\n    }\n\n    function updateProductPrices(base) {\n        let total = 0;\n        \n        if (base) {\n            setBasePrice(base);\n        } else {\n            base = basePrice;\n        }\n\n        if (product.groups.length > 0) {\n            for (let i in product.groups) {\n                const group = product.groups[i];\n                for (let key in group.options) {\n                    const option = group.options[key];\n                    if (option.quantity > 0) {\n                        const totalOptionPrice = option.price * option.quantity;\n                        total = total += totalOptionPrice;\n                    }\n                }\n            }\n        }\n\n        const totalPrice = (base + total) * quantity ;\n        \n        setTotalPrice(totalPrice);\n    }\n\n    async function validateProductAddToCart() {\n        return new Promise((resolve, reject) => {\n            if (product.groups && product.groups.length > 0) {\n                product.groups.map(group => {\n                    if (group.options && group.options.length > 0) {\n\n                        let countSelects = 0;\n                        group.options.filter(item => item.quantity > 0).map(op => {\n                            countSelects = countSelects += op.quantity;\n                        });\n\n                        if (countSelects < group.min) {\n                            return reject({ group_id: group.id, title: group.name,  message: group.rules });\n                        }\n                    }\n                })\n            }\n\n            resolve(true);\n        });\n    }\n\n    async function addCart(force = false) {\n        try {\n            if (setting.store_status.value !== \"1\") {\n                return;\n            }\n\n            if (!isLogged && !force) {\n                return setShowLoginModal(true);\n            }\n\n            setLoading(true);\n            setError({});\n\n            await validateProductAddToCart().then(async e => {\n                const productData = {\n                    product_id: product.id,\n                    quantity\n                };\n\n                productData.product_option_id = product.options.find(item => item.selected).id;\n\n                const listOptions = [];\n                product.groups.map(group => {\n                    const hasOptions = group.options.filter(op => op.quantity > 0).length;\n\n                    if (hasOptions > 0) {\n                        group.options.filter(option => option.quantity > 0).map(option => {\n                            listOptions.push({\n                                product_group_option_id: option.id,\n                                product_group_id: option.product_group_id,\n                                quantity: option.quantity\n                            });\n                        });\n\n                        return productData.options\n                    }\n                });\n\n                productData.options = listOptions;\n\n                await post('/cart', productData);\n\n                toast.success('Produto adicionado ao carrinho de compras', {\n                    position: toast.POSITION.BOTTOM_CENTER\n                });\n\n                dispatch(loadCart());\n\n                router.push('/cart');\n\n            }).catch((error) => {\n                setError(error);\n                setLoading(false);\n            });\n\n        } catch (error) {\n            console.log( error );\n        }\n    }\n\n    if (!loaded) return <Loading />;\n\n    return (\n        <Page title={product.name}>\n            <Container className=\"mb-5 productShow\">\n                <Breadcrumb />\n\n                {!isLogged && \n                    <LoginModal \n                        showLogin={showLoginModal} \n                        closeModal={() => setShowLoginModal(false)}\n                        onSuccess={() => \n                        addCart(true) } \n                    />\n                }\n\n                <Row>\n                    <Col xs={6}>\n                        <Carousel images={product.images} />\n\n                        <h4 className=\"mt-5\">Descrição</h4>\n                        <p>{product.description}</p>\n                    </Col>\n\n                    <Col className=\"pt-4\">\n                        <PageTitle className=\"name\" title={product.name}>{product.name}</PageTitle>\n                        <p>{product.short_description}</p>\n\n                        <h1 className=\"price\">{currency(totalPrice)}</h1>\n\n                        {product.options && <ListGroup className=\"options mt-4\" horizontal>\n                            {product.options.map(option =>\n                                <ListGroup.Item \n                                    key={option.id} \n                                    active={option.selected}\n                                    onClick={() => {\n                                        product.options.map(op => op.selected = false);\n                                        option.selected = true;\n                                        setBasePrice(option.price);\n                                        setProduct(() => ({...product, ...product}));\n                                    }}\n                                >\n                                    {option.name}\n                                </ListGroup.Item>\n                            )}\n                        </ListGroup>\n                        }\n\n                        <ProductGroups \n                            product={product} \n                            groups={product.groups} \n                            error={error} \n                            onChange={data => {\n                                setProduct(() => ({...product, ...data}));\n                            }}\n                        />\n                        \n                        <div className=\"d-flex mt-4\">\n                            <Button className=\"btn-quantity left btn-md\" onClick={decrementQuantity}>\n                                <i className=\"fas fa-minus-circle\"></i>\n                            </Button>\n                            <div className=\"quantity btn btn-md bg-light border-sm pl-3 pr-3 rounded-0\">\n                                {quantity || 1}\n                                </div>\n                            <Button className=\"btn-quantity right btn-md\" onClick={incrementQuantity}>\n                                <i className=\"fas fa-plus-circle\"></i>\n                            </Button>\n\n                            {setting.store_status.value === \"1\" &&\n                            <Button className=\"btn-quantity right btn-md ml-3\" disabled={loading} onClick={() => addCart()}>\n                                <i className=\"fas fa-shopping-cart\"></i> Comprar\n\n                                {loading &&\n                                    <Spinner animation=\"border\" role=\"status\">\n                                        <span className=\"sr-only\">Loading...</span>\n                                    </Spinner>\n                                }\n\n                            </Button>\n                            }\n                        </div>\n\n                    </Col>\n\n                </Row>\n            </Container>\n        </Page>\n    );\n}\n\nProductShow.getInitialProps = async function({ query }) {\n    if (!query.slug) return {\n        error: true,\n        product: {}\n    };\n\n    const product = await get(`/product/${query.slug}`);\n\n    let basePrice = product.price;\n\n    if (product.options) {\n        basePrice = product.options[0].price;\n        product.options[0].selected = true;\n    }\n    \n    return {\n        product,\n        basePrice\n    };\n};\n  \nexport default ProductShow;\n"]},"metadata":{},"sourceType":"module"}