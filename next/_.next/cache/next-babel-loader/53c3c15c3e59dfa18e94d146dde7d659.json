{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/webthomaz/Desktop/Desenvolvimento/m/monka/nps/monka-api/next/components/Cart/Checkout/index.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/router';\nimport { Form, Modal, Button, ListGroup, Alert } from 'react-bootstrap';\nimport { toast } from 'react-toastify';\nimport Spinner from '../../../components/Spinner';\nimport { get, post } from '../../../services/http';\nimport currency from '../../../utils/currency';\n\nfunction CheckoutComponent(props) {\n  var onHide = props.onHide,\n      show = props.show,\n      addresses = props.addresses,\n      addressSelected = props.addressSelected,\n      cart = props.cart,\n      cartLoading = props.cartLoading;\n\n  var _useState = useState([]),\n      paymentMethods = _useState[0],\n      setPaymentMethods = _useState[1];\n\n  var _useState2 = useState([]),\n      credits = _useState2[0],\n      setCredits = _useState2[1];\n\n  var _useState3 = useState(true),\n      loading = _useState3[0],\n      setLoading = _useState3[1];\n\n  var _useState4 = useState({}),\n      data = _useState4[0],\n      setData = _useState4[1];\n\n  var _useState5 = useState({}),\n      error = _useState5[0],\n      setError = _useState5[1];\n\n  var router = useRouter();\n  useEffect(function () {\n    if (addressSelected) {\n      data.user_address_id = addressSelected.id;\n      setData(function () {\n        return _objectSpread({}, data, {}, data);\n      });\n    }\n  }, [addressSelected]);\n  useEffect(function () {\n    function getPaymentMethods() {\n      var result;\n      return _regeneratorRuntime.async(function getPaymentMethods$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(get('/paymentMethod'));\n\n            case 2:\n              result = _context.sent;\n              setPaymentMethods(result);\n\n              if (!data.payment_method_id) {\n                data.payment_method_id = result[0].id;\n                setData(function () {\n                  return _objectSpread({}, data, {}, data);\n                });\n              }\n\n              setLoading(false);\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    }\n\n    function getCredits() {\n      var result;\n      return _regeneratorRuntime.async(function getCredits$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(get('/credit'));\n\n            case 2:\n              result = _context2.sent;\n              setCredits(result);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      });\n    }\n\n    getCredits();\n    getPaymentMethods();\n  }, []);\n\n  function processCheckout() {\n    var result;\n    return _regeneratorRuntime.async(function processCheckout$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setError({});\n            setLoading(true);\n\n            if (!(data.payment_method_id === 4 && credits.total_value < cart.total_price)) {\n              _context3.next = 4;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", setError({\n              credit: 'Você não tem créditos suficientes para realizar esse pedido. Escolha outra forma de pagamento.'\n            }));\n\n          case 4:\n            if (data.user_address_id) {\n              _context3.next = 6;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", setError({\n              user_address_id: 'Selecione um endereço para entrega.'\n            }));\n\n          case 6:\n            if (data.payment_method_id) {\n              _context3.next = 8;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", setError({\n              payment_method_id: 'Selecione a forma de pagamento.'\n            }));\n\n          case 8:\n            _context3.next = 10;\n            return _regeneratorRuntime.awrap(post('/checkout', data));\n\n          case 10:\n            result = _context3.sent;\n            toast.success('Seu pedido fopi enviado com sucesso!', {\n              position: toast.POSITION.BOTTOM_CENTER\n            });\n            router.push(\"/order/\".concat(result.id, \"?credit=\").concat(result.credit ? result.credit.id : false));\n\n          case 13:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    });\n  }\n\n  return __jsx(Modal, {\n    size: \"lg\",\n    show: show,\n    onHide: onHide,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77\n    },\n    __self: this\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  }, __jsx(Modal.Title, {\n    id: \"contained-modal-title-vcenter\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }, \"Finalizar Pedido\")), __jsx(Modal.Body, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"mb-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }, __jsx(\"h6\", {\n    className: \"text-primary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  }, \"Selecione o endere\\xE7o de entrega\"), error.user_address_id && __jsx(Alert, {\n    variant: \"danger\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }, error.user_address_id), addresses.map(function (address) {\n    return __jsx(Form.Group, {\n      key: address.id,\n      controlId: \"address-\".concat(address.id),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }, __jsx(Form.Check, {\n      type: \"radio\",\n      value: address.id,\n      checked: data.user_address_id === address.id,\n      label: \"\\n                                \".concat(address.street, \", \").concat(address.number, \" - \\n                                \").concat(address.neighborhood.name, \" \\n                            \"),\n      onChange: function onChange(e) {\n        data.user_address_id = _parseInt(e.target.value);\n        setError(_objectSpread({}, error, {\n          user_address_id: null\n        }));\n        setData(function () {\n          return _objectSpread({}, data, {}, data);\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }), __jsx(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109\n      },\n      __self: this\n    }));\n  })), paymentMethods && __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, __jsx(\"h6\", {\n    className: \"text-primary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, \"Selecione o m\\xE9todo de Pagamento\"), __jsx(ListGroup, {\n    className: \"options mt-3\",\n    horizontal: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, paymentMethods.map(function (paymentMethod) {\n    return __jsx(ListGroup.Item, {\n      key: paymentMethod.id,\n      active: data.payment_method_id === paymentMethod.id,\n      onClick: function onClick() {\n        data.payment_method_id = paymentMethod.id;\n        setData(function () {\n          return _objectSpread({}, data, {}, data);\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, paymentMethod.name);\n  }))), credits.total_value > 0 && __jsx(Alert, {\n    variant: \"success\",\n    className: \"mt-3 shadow\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }, \"Voc\\xEA tem \", currency(credits.total_value), \" dispon\\xEDvel\"), error.credit && __jsx(Alert, {\n    variant: \"danger\",\n    className: \"mt-3 shadow\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, \"Voc\\xEA n\\xE3o tem cr\\xE9ditos suficientes para realizar esse pedido. Escolha outra forma de pagamento.\"), data.payment_method_id === 4 && credits.total_value < cart.total_price && !error.credit && __jsx(Alert, {\n    variant: \"danger\",\n    className: \"mt-3 shadow\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, \"Voc\\xEA n\\xE3o tem cr\\xE9ditos suficientes para realizar esse pedido. Escolha outra forma de pagamento.\"), __jsx(Form.Group, {\n    controlId: \"observation\",\n    className: \"mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150\n    },\n    __self: this\n  }, __jsx(Form.Label, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, \"Observa\\xE7\\xE3o\"), __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: \"3\",\n    placeholder: \"Ex: (Troco Para R$ 50,00)\",\n    onChange: function onChange(e) {\n      data.observation = e.target.value;\n      setData(function () {\n        return _objectSpread({}, data, {}, data);\n      });\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  })), __jsx(ListGroup, {\n    className: \"shadow ml-3 mr-3 mb-4 border-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }, __jsx(ListGroup.Item, {\n    className: \"d-flex justify-content-between\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, \"Total de Items\"), __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, cartLoading ? __jsx(Spinner, {\n    animation: \"border\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }) : currency(cart.total_products))), __jsx(ListGroup.Item, {\n    className: \"d-flex justify-content-between\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }, \"Taxa de Entrega\"), __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }, cartLoading ? __jsx(Spinner, {\n    animation: \"border\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }) : currency(cart.shipping)))), __jsx(\"div\", {\n    className: \"btn btn-light btn-lg rounded-0 btn-block\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  }, cartLoading ? __jsx(Spinner, {\n    animation: \"border\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }) : 'Total a Pagar: ' + currency(cart.total_price))), __jsx(Modal.Footer, {\n    className: \"d-flex justify-content-between\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: onHide,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186\n    },\n    __self: this\n  }, \"Cancelar\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: processCheckout,\n    disabled: loading || cartLoading,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }, \"Confirmar Pedido\", loading && __jsx(Spinner, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }))));\n}\n\nexport default CheckoutComponent;","map":{"version":3,"sources":["/Users/webthomaz/Desktop/Desenvolvimento/m/monka/nps/monka-api/next/components/Cart/Checkout/index.js"],"names":["useState","useEffect","useRouter","Form","Modal","Button","ListGroup","Alert","toast","Spinner","get","post","currency","CheckoutComponent","props","onHide","show","addresses","addressSelected","cart","cartLoading","paymentMethods","setPaymentMethods","credits","setCredits","loading","setLoading","data","setData","error","setError","router","user_address_id","id","getPaymentMethods","result","payment_method_id","getCredits","processCheckout","total_value","total_price","credit","success","position","POSITION","BOTTOM_CENTER","push","map","address","street","number","neighborhood","name","e","target","value","paymentMethod","observation","total_products","shipping"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\nimport { useRouter } from 'next/router'\nimport { Form, Modal, Button, ListGroup, Alert } from 'react-bootstrap';\nimport { toast } from 'react-toastify';\n\nimport Spinner from '../../../components/Spinner';\n\nimport { get, post } from '../../../services/http';\nimport currency from '../../../utils/currency';\n\nfunction CheckoutComponent(props) {\n    const { onHide, show, addresses, addressSelected, cart, cartLoading } = props;\n\n    const [paymentMethods, setPaymentMethods] = useState([]);\n    const [credits, setCredits] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [data, setData] = useState({});\n    const [error, setError] = useState({});\n\n    const router = useRouter();\n\n    useEffect(() => {\n        if (addressSelected) {\n            data.user_address_id = addressSelected.id;\n            setData(() => ({ ...data, ...data }));\n        }\n    }, [addressSelected]);\n\n    useEffect(() => {\n        async function getPaymentMethods() {\n            const result = await get('/paymentMethod');\n            setPaymentMethods(result);\n\n            if (!data.payment_method_id) {\n                data.payment_method_id = result[0].id;\n                setData(() => ({ ...data, ...data }));\n            }\n\n            setLoading(false);\n        } \n\n        async function getCredits() {\n            const result = await get('/credit');\n            setCredits(result);\n        } \n\n        getCredits();\n        getPaymentMethods();\n    }, []);\n\n    async function processCheckout() {\n        setError({});\n        setLoading(true);\n\n        if (data.payment_method_id === 4 && credits.total_value < cart.total_price) {\n            return setError({ credit: 'Você não tem créditos suficientes para realizar esse pedido. Escolha outra forma de pagamento.' });\n        }\n\n        if (!data.user_address_id) {\n            return setError({ user_address_id: 'Selecione um endereço para entrega.' });\n        }\n\n        if (!data.payment_method_id) {\n            return setError({ payment_method_id: 'Selecione a forma de pagamento.' });\n        }\n\n        const result = await post('/checkout', data);\n\n        toast.success('Seu pedido fopi enviado com sucesso!', {\n            position: toast.POSITION.BOTTOM_CENTER\n        });\n\n        router.push(`/order/${result.id}?credit=${result.credit ? result.credit.id : false}`);\n    }\n\n    return (\n      <Modal\n        size=\"lg\"\n        show={show}\n        onHide={onHide}\n      >\n        <Modal.Header closeButton>\n          <Modal.Title id=\"contained-modal-title-vcenter\">\n            Finalizar Pedido\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n\n            <div className=\"mb-3\">\n                <h6 className=\"text-primary\">Selecione o endereço de entrega</h6>\n                {error.user_address_id && <Alert variant=\"danger\">{error.user_address_id}</Alert>}\n\n                {addresses.map(address => \n                    <Form.Group key={address.id} controlId={`address-${address.id}`}>\n                        <Form.Check \n                            type=\"radio\" \n                            value={address.id}\n                            checked={data.user_address_id === address.id}\n                            label={`\n                                ${address.street}, ${address.number} - \n                                ${address.neighborhood.name} \n                            `} \n                            onChange={(e) => {\n                                data.user_address_id = parseInt(e.target.value);\n                                setError({ ...error, user_address_id: null })\n                                setData(() => ({ ...data, ...data }));\n                            }}\n                        />\n                        <hr />\n                    </Form.Group>\n                )}\n            </div>\n\n            {paymentMethods && \n                <div>\n                    <h6 className=\"text-primary\">Selecione o método de Pagamento</h6>\n                    <ListGroup className=\"options mt-3\" horizontal>\n                        {paymentMethods.map(paymentMethod =>\n                            <ListGroup.Item \n                                key={paymentMethod.id} \n                                active={data.payment_method_id === paymentMethod.id}\n                                onClick={() => {\n                                    data.payment_method_id = paymentMethod.id;\n                                    setData(() => ({ ...data, ...data }));\n                                }}\n                            >\n                                {paymentMethod.name}\n                            </ListGroup.Item>\n                        )}\n                    </ListGroup>\n                </div>\n            }\n\n            {credits.total_value > 0 && \n                <Alert variant=\"success\" className=\"mt-3 shadow\">Você tem {currency(credits.total_value)} disponível</Alert>\n            }\n\n            {error.credit && \n                <Alert variant=\"danger\" className=\"mt-3 shadow\">\n                    Você não tem créditos suficientes para realizar esse pedido. Escolha outra forma de pagamento.\n                </Alert>\n            }\n\n            {data.payment_method_id === 4 && credits.total_value < cart.total_price && !error.credit && \n                <Alert variant=\"danger\" className=\"mt-3 shadow\">\n                    Você não tem créditos suficientes para realizar esse pedido. Escolha outra forma de pagamento.\n                </Alert>\n            }\n            \n            <Form.Group controlId=\"observation\" className=\"mt-3\">\n                <Form.Label>Observação</Form.Label>\n                <Form.Control \n                    as=\"textarea\"\n                    rows=\"3\" \n                    placeholder=\"Ex: (Troco Para R$ 50,00)\"\n                    onChange={(e) => {\n                    data.observation = e.target.value;\n                    setData(() => ({ ...data, ...data }));\n                }} />\n            </Form.Group>\n\n            <ListGroup className=\"shadow ml-3 mr-3 mb-4 border-0\">\n                <ListGroup.Item className=\"d-flex justify-content-between\">\n                    <div>\n                        Total de Items \n                    </div>\n                    <div>\n                        {cartLoading ? <Spinner animation=\"border\" /> : currency(cart.total_products)}\n                    </div>\n                </ListGroup.Item>\n                <ListGroup.Item className=\"d-flex justify-content-between\">\n                    <div>\n                        Taxa de Entrega \n                    </div>\n                    <div>\n                        {cartLoading ? <Spinner animation=\"border\" /> : currency(cart.shipping)}\n                    </div>\n                </ListGroup.Item>\n            </ListGroup>\n\n            <div className=\"btn btn-light btn-lg rounded-0 btn-block\">\n                {cartLoading ? <Spinner animation=\"border\" /> : 'Total a Pagar: ' + currency(cart.total_price)}\n            </div>\n        </Modal.Body>\n        <Modal.Footer className=\"d-flex justify-content-between\">\n            <Button variant=\"secondary\" onClick={onHide}>\n                Cancelar\n            </Button>\n            <Button variant=\"primary\" onClick={processCheckout} disabled={loading || cartLoading}>\n                Confirmar Pedido\n                {loading && <Spinner />}\n            </Button>\n        </Modal.Footer>\n      </Modal>\n    );\n}\n\nexport default CheckoutComponent;"]},"metadata":{},"sourceType":"module"}