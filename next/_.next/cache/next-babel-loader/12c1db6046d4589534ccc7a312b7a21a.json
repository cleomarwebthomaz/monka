{"ast":null,"code":"var _jsxFileName = \"/Users/webthomaz/Desktop/Desenvolvimento/m/monka/monka-api/next/pages/components/ProducItem/show.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Modal, Button, Image, ListGroup, Spinner, Form } from \"react-bootstrap\";\nimport { useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toast } from 'react-toastify';\nimport Carousel from './Carousel';\nimport ProductGroups from './Groups';\nimport LoginModal from '../../auth/Modal';\nimport currency from \"../../../utils/currency\";\nimport { post } from \"../../../services/http\";\nimport { loadCart, showCart } from \"../../../store/actions/cart\";\nexport default function (props) {\n  const {\n    show,\n    setShow,\n    setting\n  } = props;\n  const {\n    0: product,\n    1: setProduct\n  } = useState(props.product);\n  const {\n    0: quantity,\n    1: setQuantity\n  } = useState(props.product.quantity || 1);\n  const {\n    0: basePrice,\n    1: setBasePrice\n  } = useState(props.product.price);\n  const {\n    0: totalPrice,\n    1: setTotalPrice\n  } = useState(props.product.price);\n  const {\n    0: error,\n    1: setError\n  } = useState({});\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: showLoginModal,\n    1: setShowLoginModal\n  } = useState(false);\n  const {\n    0: showObservation,\n    1: setShowObservation\n  } = useState(false);\n  const {\n    0: observation,\n    1: setObservation\n  } = useState('');\n  const dispatch = useDispatch();\n  const {\n    isLogged\n  } = useSelector(state => state.auth);\n  useEffect(() => {\n    if (product.options) {\n      const selected = product.options.find(item => item.selected);\n\n      if (!selected) {\n        product.options[0].selected = true;\n        setBasePrice(product.options[0].price);\n      }\n    }\n  }, []);\n\n  function updateProductPrices(base) {\n    let total = 0;\n\n    if (base) {\n      setBasePrice(base);\n    } else {\n      base = basePrice;\n    }\n\n    if (product.groups.length > 0) {\n      for (let i in product.groups) {\n        const group = product.groups[i];\n\n        for (let key in group.options) {\n          const option = group.options[key];\n\n          if (option.quantity > 0) {\n            const totalOptionPrice = option.price * option.quantity;\n            total = total += totalOptionPrice;\n          }\n        }\n      }\n    }\n\n    const totalPrice = (base + total) * quantity;\n    setTotalPrice(totalPrice);\n  }\n\n  const handleClose = () => {\n    setShow(false);\n  };\n\n  useEffect(() => {\n    updateProductPrices();\n  }, [quantity, basePrice, product]);\n\n  function incrementQuantity() {\n    let newQuantity = quantity;\n    newQuantity = newQuantity += 1;\n    setQuantity(newQuantity);\n  }\n\n  function decrementQuantity() {\n    let newQuantity = quantity;\n    newQuantity = newQuantity -= 1;\n    if (newQuantity <= 0) newQuantity = 1;\n    setQuantity(newQuantity);\n  }\n\n  async function addCart(force = false) {\n    try {\n      if (setting.store_status.value !== \"1\") {\n        return;\n      }\n\n      if (!isLogged && !force) {\n        setShow(false);\n        return setShowLoginModal(true);\n      }\n\n      setLoading(true);\n      setError({});\n      await validateProductAddToCart().then(async e => {\n        const productData = {\n          product_id: product.id,\n          quantity\n        };\n        productData.product_option_id = product.options.find(item => item.selected).id;\n        const listOptions = [];\n        product.groups.map(group => {\n          const hasOptions = group.options.filter(op => op.quantity > 0).length;\n\n          if (hasOptions > 0) {\n            group.options.filter(option => option.quantity > 0).map(option => {\n              listOptions.push({\n                product_group_option_id: option.id,\n                product_group_id: option.product_group_id,\n                quantity: option.quantity\n              });\n            });\n            return productData.options;\n          }\n        });\n        productData.options = listOptions;\n        await post('/cart', productData);\n        toast.success('Produto adicionado ao carrinho de compras', {\n          position: toast.POSITION.BOTTOM_CENTER\n        });\n        dispatch(loadCart());\n        dispatch(showCart(true));\n        setShow(false);\n        setLoading(false);\n      }).catch(error => {\n        setError(error);\n        setLoading(false);\n        console.log(error);\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  async function validateProductAddToCart() {\n    return new Promise((resolve, reject) => {\n      if (product.groups && product.groups.length > 0) {\n        product.groups.map(group => {\n          if (group.options && group.options.length > 0) {\n            let countSelects = 0;\n            group.options.filter(item => item.quantity > 0).map(op => {\n              countSelects = countSelects += op.quantity;\n            });\n\n            if (countSelects < group.min) {\n              return reject({\n                group_id: group.id,\n                title: group.name,\n                message: group.rules\n              });\n            }\n          }\n        });\n      }\n\n      resolve(true);\n    });\n  }\n\n  return __jsx(React.Fragment, null, !isLogged && __jsx(LoginModal, {\n    showLogin: showLoginModal,\n    closeModal: () => {\n      setShowLoginModal(false);\n      setShow(true);\n    },\n    onSuccess: () => {\n      setShow(true);\n      addCart(true);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }), __jsx(Modal, {\n    show: showObservation,\n    onHide: handleClose,\n    animation: false,\n    size: \"md\",\n    className: \"modal-product-show\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    className: \"border-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }, __jsx(\"h4\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  }, \"Observa\\xE7\\xE3o\")), __jsx(Modal.Body, {\n    style: {\n      overflow: 'auto',\n      maxHeight: 610\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  }, __jsx(Form.Group, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197\n    },\n    __self: this\n  }, __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: \"3\",\n    onChange: e => setObservation(e.target.value),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198\n    },\n    __self: this\n  }))), __jsx(Modal.Footer, {\n    className: \"d-flex justify-content-between align-items-center pt-0 pb-0 bg-success\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: () => {\n      setShowObservation(false);\n      setShow(true);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207\n    },\n    __self: this\n  }, \"Cancelar\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: () => {\n      setShowObservation(false);\n      addCart();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213\n    },\n    __self: this\n  }, \"Continuar\"))), __jsx(Modal, {\n    show: show,\n    onHide: handleClose,\n    animation: false,\n    size: \"md\",\n    className: \"modal-product-show\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220\n    },\n    __self: this\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    className: \"border-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221\n    },\n    __self: this\n  }), __jsx(Modal.Body, {\n    style: {\n      overflow: 'auto',\n      maxHeight: 610\n    },\n    className: \"modal-body-show\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223\n    },\n    __self: this\n  }, __jsx(Carousel, {\n    images: product.images,\n    imageDefault: product.image_url,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224\n    },\n    __self: this\n  }), __jsx(\"h3\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226\n    },\n    __self: this\n  }, product.name), __jsx(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227\n    },\n    __self: this\n  }, product.description), product.options && __jsx(ListGroup, {\n    className: \"options mt-4 mb-4\",\n    horizontal: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }, product.options.map(option => __jsx(ListGroup.Item, {\n    key: option.id,\n    active: option.selected,\n    onClick: () => {\n      product.options.map(op => op.selected = false);\n      option.selected = true;\n      setBasePrice(option.price);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232\n    },\n    __self: this\n  }, option.name))), __jsx(ProductGroups, {\n    product: product,\n    groups: product.groups,\n    error: error,\n    onChange: data => {\n      setProduct(() => _objectSpread({}, product, {}, data));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247\n    },\n    __self: this\n  })), __jsx(Modal.Footer, {\n    className: \"d-flex justify-content-between align-items-center pt-0 pb-0 bg-success\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258\n    },\n    __self: this\n  }, __jsx(\"h5\", {\n    className: \"price text-white pt-1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259\n    },\n    __self: this\n  }, currency(totalPrice)), __jsx(\"div\", {\n    className: \"d-flex\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261\n    },\n    __self: this\n  }, isLogged && __jsx(React.Fragment, null, __jsx(Button, {\n    className: \"btn-quantity border-0 left btn-sm\",\n    onClick: decrementQuantity,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-minus-circle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: \"quantity btn btn-sm border-sm pl-3 pr-3 rounded-0 text-white\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267\n    },\n    __self: this\n  }, quantity || 1), __jsx(Button, {\n    className: \"btn-quantity border-0 right btn-sm\",\n    onClick: incrementQuantity,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-plus-circle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271\n    },\n    __self: this\n  }))), setting.store_status.value === \"1\" && __jsx(Button, {\n    className: \"btn-quantity right btn-md ml-3 border-0 text-uppercase\",\n    disabled: loading,\n    onClick: () => {\n      setShowObservation(true);\n      setShow(false);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-shopping-cart\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282\n    },\n    __self: this\n  }), \" Pedir\", loading && __jsx(Spinner, {\n    animation: \"border\",\n    role: \"status\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285\n    },\n    __self: this\n  }, __jsx(\"span\", {\n    className: \"sr-only\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286\n    },\n    __self: this\n  }, \"Loading...\")))))));\n}","map":{"version":3,"sources":["/Users/webthomaz/Desktop/Desenvolvimento/m/monka/monka-api/next/pages/components/ProducItem/show.js"],"names":["Modal","Button","Image","ListGroup","Spinner","Form","useState","useEffect","useDispatch","useSelector","toast","Carousel","ProductGroups","LoginModal","currency","post","loadCart","showCart","props","show","setShow","setting","product","setProduct","quantity","setQuantity","basePrice","setBasePrice","price","totalPrice","setTotalPrice","error","setError","loading","setLoading","showLoginModal","setShowLoginModal","showObservation","setShowObservation","observation","setObservation","dispatch","isLogged","state","auth","options","selected","find","item","updateProductPrices","base","total","groups","length","i","group","key","option","totalOptionPrice","handleClose","incrementQuantity","newQuantity","decrementQuantity","addCart","force","store_status","value","validateProductAddToCart","then","e","productData","product_id","id","product_option_id","listOptions","map","hasOptions","filter","op","push","product_group_option_id","product_group_id","success","position","POSITION","BOTTOM_CENTER","catch","console","log","Promise","resolve","reject","countSelects","min","group_id","title","name","message","rules","overflow","maxHeight","target","images","image_url","description","data"],"mappings":"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","sourcesContent":["import { Modal, Button, Image, ListGroup, Spinner, Form } from \"react-bootstrap\";\nimport { useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toast } from 'react-toastify';\n\nimport Carousel from './Carousel';\nimport ProductGroups from './Groups';\n\nimport LoginModal from '../../auth/Modal';\n\nimport currency from \"../../../utils/currency\";\nimport { post } from \"../../../services/http\";\nimport { loadCart, showCart } from \"../../../store/actions/cart\";\n\n\nexport default function(props) {\n    const {show, setShow, setting } = props;\n    const [product, setProduct] = useState(props.product);\n    const [quantity, setQuantity] = useState(props.product.quantity || 1);\n    const [basePrice, setBasePrice] = useState(props.product.price);\n    const [totalPrice, setTotalPrice] = useState(props.product.price);\n    const [error, setError] = useState({});\n    const [loading, setLoading] = useState(false);\n    const [showLoginModal, setShowLoginModal] = useState(false);\n    const [showObservation, setShowObservation] = useState(false);\n    const [observation, setObservation] = useState('');\n\n    const dispatch = useDispatch();\n    const { isLogged } = useSelector(state => state.auth);\n\n    useEffect(() => {\n        if (product.options) {\n            const selected = product.options.find(item => item.selected);\n\n            if (!selected) {\n                product.options[0].selected = true;\n                setBasePrice(product.options[0].price);\n            }\n        }\n\n    }, []);\n\n    function updateProductPrices(base) {\n        let total = 0;\n        \n        if (base) {\n            setBasePrice(base);\n        } else {\n            base = basePrice;\n        }\n\n        if (product.groups.length > 0) {\n            for (let i in product.groups) {\n                const group = product.groups[i];\n                for (let key in group.options) {\n                    const option = group.options[key];\n                    if (option.quantity > 0) {\n                        const totalOptionPrice = option.price * option.quantity;\n                        total = total += totalOptionPrice;\n                    }\n                }\n            }\n        }\n\n        const totalPrice = (base + total) * quantity ;\n        \n        setTotalPrice(totalPrice);\n    }\n\n    const handleClose = () => {\n        setShow(false);\n    }\n\n    useEffect(() => {\n        updateProductPrices();\n    }, [quantity, basePrice, product]);\n\n    function incrementQuantity() {\n        let newQuantity = quantity;\n        newQuantity = newQuantity += 1;\n        setQuantity(newQuantity);\n    }\n    \n    function decrementQuantity() {\n        let newQuantity = quantity;\n        newQuantity = newQuantity -= 1;\n        if (newQuantity <= 0) newQuantity = 1;\n        setQuantity(newQuantity);\n    }\n\n    async function addCart(force = false) {\n        try {\n            if (setting.store_status.value !== \"1\") {\n                return;\n            }\n\n            if (!isLogged && !force) {\n                setShow(false);\n                return setShowLoginModal(true);\n            }\n\n            setLoading(true);\n            setError({});\n\n            await validateProductAddToCart().then(async e => {\n                const productData = {\n                    product_id: product.id,\n                    quantity\n                };\n\n                productData.product_option_id = product.options.find(item => item.selected).id;\n\n                const listOptions = [];\n                product.groups.map(group => {\n                    const hasOptions = group.options.filter(op => op.quantity > 0).length;\n\n                    if (hasOptions > 0) {\n                        group.options.filter(option => option.quantity > 0).map(option => {\n                            listOptions.push({\n                                product_group_option_id: option.id,\n                                product_group_id: option.product_group_id,\n                                quantity: option.quantity\n                            });\n                        });\n\n                        return productData.options\n                    }\n                });\n\n                productData.options = listOptions;\n\n                await post('/cart', productData);\n\n                toast.success('Produto adicionado ao carrinho de compras', { position: toast.POSITION.BOTTOM_CENTER });\n\n                dispatch(loadCart());\n                dispatch(showCart(true));\n\n                setShow(false);\n                setLoading(false);\n\n            }).catch((error) => {\n                setError(error);\n                setLoading(false);\n                console.log(error);\n            });\n\n        } catch (error) {\n            console.log( error );\n        }\n    }\n\n    async function validateProductAddToCart() {\n        return new Promise((resolve, reject) => {\n            if (product.groups && product.groups.length > 0) {\n                product.groups.map(group => {\n                    if (group.options && group.options.length > 0) {\n\n                        let countSelects = 0;\n                        group.options.filter(item => item.quantity > 0).map(op => {\n                            countSelects = countSelects += op.quantity;\n                        });\n\n                        if (countSelects < group.min) {\n                            return reject({ group_id: group.id, title: group.name,  message: group.rules });\n                        }\n                    }\n                })\n            }\n\n            resolve(true);\n        });\n    }\n\n    return (\n        <>\n        {!isLogged &&\n            <LoginModal \n                showLogin={showLoginModal} \n                closeModal={() => {\n                    setShowLoginModal(false);\n                    setShow(true);\n                }}\n                onSuccess={() => {\n                    setShow(true);\n                    addCart(true);\n                }}\n            />\n        }\n\n        <Modal show={showObservation} onHide={handleClose} animation={false} size=\"md\" className=\"modal-product-show\">\n            <Modal.Header closeButton className=\"border-0\">\n                <h4>Observação</h4>\n            </Modal.Header>\n\n            <Modal.Body style={{ overflow: 'auto', maxHeight: 610 }}>\n                <Form.Group>\n                    <Form.Control\n                        as=\"textarea\" \n                        rows=\"3\"\n                        onChange={e => setObservation(e.target.value)}\n                    />\n                </Form.Group>\n            </Modal.Body>\n\n            <Modal.Footer className=\"d-flex justify-content-between align-items-center pt-0 pb-0 bg-success\">\n                <Button variant=\"secondary\" onClick={() => {\n                    setShowObservation(false);\n                    setShow(true);\n                }}>\n                    Cancelar\n                </Button>\n                <Button variant=\"primary\" onClick={() => {\n                    setShowObservation(false);\n                    addCart();\n                }}>Continuar</Button>\n            </Modal.Footer>\n        </Modal>\n\n       <Modal show={show} onHide={handleClose} animation={false} size=\"md\" className=\"modal-product-show\">\n        <Modal.Header closeButton className=\"border-0\" />\n\n        <Modal.Body style={{ overflow: 'auto', maxHeight: 610 }} className=\"modal-body-show\">\n            <Carousel images={product.images} imageDefault={product.image_url} />\n\n            <h3>{product.name}</h3>\n            <p>{product.description}</p>\n\n            {product.options && \n                <ListGroup className=\"options mt-4 mb-4\" horizontal>\n                    {product.options.map(option =>\n                        <ListGroup.Item \n                            key={option.id} \n                            active={option.selected}\n                            onClick={() => {\n                                product.options.map(op => op.selected = false);\n                                option.selected = true;\n                                setBasePrice(option.price);\n                            }}\n                        >\n                            {option.name}\n                        </ListGroup.Item>\n                    )}\n                </ListGroup>\n            }\n\n            <ProductGroups \n                product={product} \n                groups={product.groups} \n                error={error} \n                onChange={data => {\n                    setProduct(() => ({...product, ...data}));\n                }}\n            />\n\n        </Modal.Body>\n\n        <Modal.Footer className=\"d-flex justify-content-between align-items-center pt-0 pb-0 bg-success\">\n            <h5 className=\"price text-white pt-1\">{currency(totalPrice)}</h5>\n\n            <div className=\"d-flex\">\n                {isLogged &&\n                <>\n                    <Button className=\"btn-quantity border-0 left btn-sm\" onClick={decrementQuantity}>\n                        <i className=\"fas fa-minus-circle\"></i>\n                    </Button>\n                    <div className=\"quantity btn btn-sm border-sm pl-3 pr-3 rounded-0 text-white\">\n                        {quantity || 1}\n                    </div>\n                    <Button className=\"btn-quantity border-0 right btn-sm\" onClick={incrementQuantity}>\n                        <i className=\"fas fa-plus-circle\"></i>\n                    </Button>\n                </>\n                }\n\n                {setting.store_status.value === \"1\" &&\n                    <Button className=\"btn-quantity right btn-md ml-3 border-0 text-uppercase\" disabled={loading} onClick={() => {\n                        setShowObservation(true);\n                        setShow(false);\n                     }}>\n                        \n                        <i className=\"fas fa-shopping-cart\"></i> Pedir\n\n                        {loading &&\n                            <Spinner animation=\"border\" role=\"status\">\n                                <span className=\"sr-only\">Loading...</span>\n                            </Spinner>\n                        }\n\n                    </Button>\n                }\n            </div>\n        </Modal.Footer>\n      </Modal>   \n\n      </>     \n    );\n    \n}\n  \n"]},"metadata":{},"sourceType":"module"}