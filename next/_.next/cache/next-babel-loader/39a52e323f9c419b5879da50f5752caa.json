{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Link from 'next/link';\nimport { Form, Button, Spinner, Alert } from 'react-bootstrap';\nimport { useRouter } from 'next/router';\nimport { withFormik } from 'formik';\nimport * as Yup from 'yup';\nimport { toast } from 'react-toastify';\nimport { useEffect } from 'react';\nimport { withRouter } from 'next/router';\nimport Layout from '../../../../components/Layouts';\nimport Page from '../../../../components/Page';\nimport { post } from '../../../../services/http';\n\nfunction ChangePasswordForm(props) {\n  var router = useRouter();\n  useEffect(function () {\n    var token = props.router.query.token;\n    props.setFieldValue('token', token);\n  }, []);\n  useEffect(function () {\n    if (props.status && props.status.success) {\n      toast.success('Sua senha alterada com sucesso. Faça o login!', {\n        position: toast.POSITION.BOTTOM_CENTER\n      });\n      router.push('/auth/access');\n    }\n  }, [props.status]);\n  var crumbs = [{\n    name: 'Alterar Senha'\n  }];\n  var pageTitle = 'Alterar minha Senha';\n  return __jsx(Page, {\n    crumbs: crumbs,\n    title: pageTitle\n  }, __jsx(Layout, {\n    pageTitle: pageTitle\n  }, __jsx(Form, {\n    onSubmit: props.handleSubmit\n  }, props.errors.error && __jsx(Alert, {\n    variant: \"danger\"\n  }, __jsx(Form.Control.Feedback, {\n    type: \"invalid\"\n  }, props.errors.error)), __jsx(Form.Group, null, __jsx(Form.Label, null, \"Nova Senha\"), __jsx(Form.Control, {\n    type: \"password\",\n    name: \"password\",\n    placeholder: \"Nova Senha\",\n    onChange: function onChange(e) {\n      return props.setFieldValue('password', e.target.value);\n    },\n    value: props.values.password\n  }), props.touched.password && props.errors.password && __jsx(Form.Control.Feedback, {\n    type: \"invalid\"\n  }, props.errors.password)), __jsx(Form.Group, null, __jsx(Form.Label, null, \"Confirme a nova Senha\"), __jsx(Form.Control, {\n    type: \"password\",\n    name: \"confirm_password\",\n    placeholder: \"Confirme a nova Senha\",\n    onChange: function onChange(e) {\n      return props.setFieldValue('confirm_password', e.target.value);\n    },\n    value: props.values.confirm_password\n  }), props.touched.confirm_password && props.errors.confirm_password && __jsx(Form.Control.Feedback, {\n    type: \"invalid\"\n  }, props.errors.confirm_password)), __jsx(\"div\", {\n    className: \"mt-3 mb-5 d-flex justify-content-between\"\n  }, __jsx(Link, {\n    href: \"/auth/forgot-password\"\n  }, __jsx(\"a\", {\n    className: \"btn btn-secondary\"\n  }, \"Solicitar novo token\")), __jsx(\"button\", {\n    className: \"btn btn-primary\",\n    type: \"submit\"\n  }, \"Salvar\", __jsx(\"i\", {\n    className: \"fas fa-disk\"\n  }), props.isSubmitting && __jsx(Spinner, null))))));\n}\n\nexport default withFormik({\n  mapPropsToValues: function mapPropsToValues(props) {\n    return {\n      password: '',\n      confirm_password: '',\n      token: ''\n    };\n  },\n  validationSchema: Yup.object().shape({\n    password: Yup.string().required('Informe uma nova senha').min(5, 'A senha deve ter no mínimo 5 caracteres'),\n    confirm_password: Yup.string().oneOf([Yup.ref('password'), null], 'As senhas não correspondem')\n  }),\n  handleSubmit: function handleSubmit(values, _ref) {\n    var setSubmitting, setErrors, setStatus, data;\n    return _regeneratorRuntime.async(function handleSubmit$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            setSubmitting = _ref.setSubmitting, setErrors = _ref.setErrors, setStatus = _ref.setStatus;\n            _context.prev = 1;\n            setSubmitting(true);\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(post(\"/auth/recoverPassword\", values));\n\n          case 5:\n            data = _context.sent;\n\n            if (data.success) {\n              setSubmitting(false);\n              setStatus({\n                success: true\n              });\n            }\n\n            if (data.error) {\n              setErrors({\n                error: data.error\n              });\n            }\n\n            if (!data) {\n              setErrors({\n                error: 'Token inválido. Solicite um novo token.'\n              });\n            }\n\n            _context.next = 14;\n            break;\n\n          case 11:\n            _context.prev = 11;\n            _context.t0 = _context[\"catch\"](1);\n            setErrors({\n              error: 'Não foi possível alterar a senha. Tente novamente.'\n            });\n\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[1, 11]]);\n  }\n})(withRouter(ChangePasswordForm));","map":null,"metadata":{},"sourceType":"module"}