{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nvar _jsxFileName = \"/Users/webthomaz/Desktop/Desenvolvimento/m/monka/nps/monka-api/next/pages/components/ProducItem/show.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Modal, Button, Image, ListGroup, Spinner, Form } from \"react-bootstrap\";\nimport { useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toast } from 'react-toastify';\nimport Carousel from './Carousel';\nimport ProductGroups from './Groups';\nimport LoginModal from '../../auth/Modal';\nimport currency from \"../../../utils/currency\";\nimport { post } from \"../../../services/http\";\nimport { loadCart, showCart } from \"../../../store/actions/cart\";\nexport default function (props) {\n  var show = props.show,\n      setShow = props.setShow,\n      setting = props.setting;\n\n  var _useState = useState(props.product),\n      product = _useState[0],\n      setProduct = _useState[1];\n\n  var _useState2 = useState(props.product.quantity || 1),\n      quantity = _useState2[0],\n      setQuantity = _useState2[1];\n\n  var _useState3 = useState(props.product.price),\n      basePrice = _useState3[0],\n      setBasePrice = _useState3[1];\n\n  var _useState4 = useState(props.product.price),\n      totalPrice = _useState4[0],\n      setTotalPrice = _useState4[1];\n\n  var _useState5 = useState({}),\n      error = _useState5[0],\n      setError = _useState5[1];\n\n  var _useState6 = useState(false),\n      loading = _useState6[0],\n      setLoading = _useState6[1];\n\n  var _useState7 = useState(false),\n      showLoginModal = _useState7[0],\n      setShowLoginModal = _useState7[1];\n\n  var _useState8 = useState(''),\n      observation = _useState8[0],\n      setObservation = _useState8[1];\n\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return state.auth;\n  }),\n      isLogged = _useSelector.isLogged;\n\n  useEffect(function () {\n    if (product.options) {\n      var selected = product.options.find(function (item) {\n        return item.selected;\n      });\n\n      if (!selected && product.options.lenght > 0) {\n        product.options[0].selected = true;\n        setBasePrice(product.options[0].price);\n      }\n    }\n  }, []);\n\n  function updateProductPrices(base) {\n    var total = 0;\n\n    if (base) {\n      setBasePrice(base);\n    } else {\n      base = basePrice;\n    }\n\n    if (product.groups.length > 0) {\n      for (var i in product.groups) {\n        var group = product.groups[i];\n\n        for (var key in group.options) {\n          var option = group.options[key];\n\n          if (option.quantity > 0) {\n            var totalOptionPrice = option.price * option.quantity;\n            total = total += totalOptionPrice;\n          }\n        }\n      }\n    }\n\n    var totalPrice = (base + total) * quantity;\n    setTotalPrice(totalPrice);\n  }\n\n  var handleClose = function handleClose() {\n    setShow(false);\n  };\n\n  useEffect(function () {\n    updateProductPrices();\n  }, [quantity, basePrice, product]);\n\n  function incrementQuantity() {\n    var newQuantity = quantity;\n    newQuantity = newQuantity += 1;\n    setQuantity(newQuantity);\n  }\n\n  function decrementQuantity() {\n    var newQuantity = quantity;\n    newQuantity = newQuantity -= 1;\n    if (newQuantity <= 0) newQuantity = 1;\n    setQuantity(newQuantity);\n  }\n\n  function addCart() {\n    var force,\n        _args2 = arguments;\n    return _regeneratorRuntime.async(function addCart$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            force = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : false;\n            _context2.prev = 1;\n\n            if (!(setting.store_status.value !== \"1\")) {\n              _context2.next = 4;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 4:\n            console.log(isLogged);\n\n            if (!(!isLogged && !force)) {\n              _context2.next = 8;\n              break;\n            }\n\n            setShow(false);\n            return _context2.abrupt(\"return\", setShowLoginModal(true));\n\n          case 8:\n            setLoading(true);\n            setError({});\n            _context2.next = 12;\n            return _regeneratorRuntime.awrap(validateProductAddToCart().then(function _callee(e) {\n              var productData, listOptions;\n              return _regeneratorRuntime.async(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      productData = {\n                        product_id: product.id,\n                        quantity: quantity,\n                        observation: observation\n                      };\n                      productData.product_option_id = product.options.find(function (item) {\n                        return item.selected;\n                      }).id;\n                      listOptions = [];\n                      product.groups.map(function (group) {\n                        var hasOptions = group.options.filter(function (op) {\n                          return op.quantity > 0;\n                        }).length;\n\n                        if (hasOptions > 0) {\n                          group.options.filter(function (option) {\n                            return option.quantity > 0;\n                          }).map(function (option) {\n                            listOptions.push({\n                              product_group_option_id: option.id,\n                              product_group_id: option.product_group_id,\n                              quantity: option.quantity\n                            });\n                          });\n                          return productData.options;\n                        }\n                      });\n                      productData.options = listOptions;\n                      _context.next = 7;\n                      return _regeneratorRuntime.awrap(post('/cart', productData));\n\n                    case 7:\n                      toast.success('Produto adicionado ao carrinho de compras', {\n                        position: toast.POSITION.BOTTOM_CENTER\n                      });\n                      dispatch(loadCart());\n                      dispatch(showCart(true));\n                      setShow(false);\n                      setLoading(false);\n\n                    case 12:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              });\n            })[\"catch\"](function (error) {\n              setError(error);\n              setLoading(false);\n              console.log(error);\n            }));\n\n          case 12:\n            _context2.next = 17;\n            break;\n\n          case 14:\n            _context2.prev = 14;\n            _context2.t0 = _context2[\"catch\"](1);\n            console.log(_context2.t0);\n\n          case 17:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[1, 14]]);\n  }\n\n  function validateProductAddToCart() {\n    return _regeneratorRuntime.async(function validateProductAddToCart$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            return _context3.abrupt(\"return\", new _Promise(function (resolve, reject) {\n              if (product.groups && product.groups.length > 0) {\n                product.groups.map(function (group) {\n                  if (group.options && group.options.length > 0) {\n                    var countSelects = 0;\n                    group.options.filter(function (item) {\n                      return item.quantity > 0;\n                    }).map(function (op) {\n                      countSelects = countSelects += op.quantity;\n                    });\n\n                    if (countSelects < group.min) {\n                      return reject({\n                        group_id: group.id,\n                        title: group.name,\n                        message: group.rules\n                      });\n                    }\n                  }\n                });\n              }\n\n              resolve(true);\n            }));\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    });\n  }\n\n  return __jsx(React.Fragment, null, !isLogged && __jsx(LoginModal, {\n    showLogin: showLoginModal,\n    closeModal: function closeModal() {\n      setShowLoginModal(false);\n      setShow(true);\n    },\n    onSuccess: function onSuccess() {\n      setShow(true);\n      addCart(true);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }), __jsx(Modal, {\n    show: show,\n    onHide: handleClose,\n    animation: true,\n    size: \"md\",\n    className: \"modal-product-show\",\n    centered: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    className: \"border-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  }, __jsx(\"h3\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194\n    },\n    __self: this\n  }, product.name)), __jsx(Modal.Body, {\n    className: \"modal-body-show\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197\n    },\n    __self: this\n  }, __jsx(Carousel, {\n    images: product.images,\n    imageDefault: product.image_url,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198\n    },\n    __self: this\n  }), __jsx(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }, product.description), product.options && __jsx(ListGroup, {\n    className: \"options mt-4 mb-4\",\n    horizontal: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203\n    },\n    __self: this\n  }, product.options.map(function (option) {\n    return __jsx(ListGroup.Item, {\n      key: option.id,\n      active: option.selected,\n      onClick: function onClick() {\n        product.options.map(function (op) {\n          return op.selected = false;\n        });\n        option.selected = true;\n        setBasePrice(option.price);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }, option.name);\n  })), __jsx(ProductGroups, {\n    product: product,\n    groups: product.groups,\n    error: error,\n    onChange: function onChange(data) {\n      setProduct(function () {\n        return _objectSpread({}, product, {}, data);\n      });\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220\n    },\n    __self: this\n  }), __jsx(Form.Group, {\n    className: \"mt-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229\n    },\n    __self: this\n  }, __jsx(Form.Label, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }, \"Observa\\xE7\\xE3o\"), __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: \"2\",\n    onChange: function onChange(e) {\n      return setObservation(e.target.value);\n    },\n    defaultValue: observation,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231\n    },\n    __self: this\n  }))), __jsx(Modal.Footer, {\n    className: \"d-flex justify-content-between align-items-center pt-0 pb-0 bg-success\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241\n    },\n    __self: this\n  }, __jsx(\"h5\", {\n    className: \"price text-white pt-1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242\n    },\n    __self: this\n  }, currency(totalPrice)), __jsx(\"div\", {\n    className: \"d-flex\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244\n    },\n    __self: this\n  }, isLogged && __jsx(React.Fragment, null, __jsx(Button, {\n    className: \"btn-quantity border-0 left btn-sm\",\n    onClick: decrementQuantity,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-minus-circle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: \"quantity btn btn-sm border-sm pl-3 pr-3 rounded-0 text-white\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250\n    },\n    __self: this\n  }, quantity || 1), __jsx(Button, {\n    className: \"btn-quantity border-0 right btn-sm\",\n    onClick: incrementQuantity,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-plus-circle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254\n    },\n    __self: this\n  }))), setting.store_status.value === \"1\" && __jsx(Button, {\n    className: \"btn-quantity right btn-md ml-3 border-0 text-uppercase\",\n    disabled: loading,\n    onClick: function onClick() {\n      setShow(false);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260\n    },\n    __self: this\n  }, __jsx(\"i\", {\n    className: \"fas fa-shopping-cart\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264\n    },\n    __self: this\n  }), \" Pedir\", loading && __jsx(Spinner, {\n    animation: \"border\",\n    role: \"status\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267\n    },\n    __self: this\n  }, __jsx(\"span\", {\n    className: \"sr-only\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268\n    },\n    __self: this\n  }, \"Loading...\")))))));\n}","map":{"version":3,"sources":["/Users/webthomaz/Desktop/Desenvolvimento/m/monka/nps/monka-api/next/pages/components/ProducItem/show.js"],"names":["Modal","Button","Image","ListGroup","Spinner","Form","useState","useEffect","useDispatch","useSelector","toast","Carousel","ProductGroups","LoginModal","currency","post","loadCart","showCart","props","show","setShow","setting","product","setProduct","quantity","setQuantity","price","basePrice","setBasePrice","totalPrice","setTotalPrice","error","setError","loading","setLoading","showLoginModal","setShowLoginModal","observation","setObservation","dispatch","state","auth","isLogged","options","selected","find","item","lenght","updateProductPrices","base","total","groups","length","i","group","key","option","totalOptionPrice","handleClose","incrementQuantity","newQuantity","decrementQuantity","addCart","force","store_status","value","console","log","validateProductAddToCart","then","e","productData","product_id","id","product_option_id","listOptions","map","hasOptions","filter","op","push","product_group_option_id","product_group_id","success","position","POSITION","BOTTOM_CENTER","resolve","reject","countSelects","min","group_id","title","name","message","rules","images","image_url","description","data","target"],"mappings":"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","sourcesContent":["import { Modal, Button, Image, ListGroup, Spinner, Form } from \"react-bootstrap\";\nimport { useState, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { toast } from 'react-toastify';\n\nimport Carousel from './Carousel';\nimport ProductGroups from './Groups';\n\nimport LoginModal from '../../auth/Modal';\n\nimport currency from \"../../../utils/currency\";\nimport { post } from \"../../../services/http\";\nimport { loadCart, showCart } from \"../../../store/actions/cart\";\n\nexport default function(props) {\n    const {show, setShow, setting } = props;\n    const [product, setProduct] = useState(props.product);\n    const [quantity, setQuantity] = useState(props.product.quantity || 1);\n    const [basePrice, setBasePrice] = useState(props.product.price);\n    const [totalPrice, setTotalPrice] = useState(props.product.price);\n    const [error, setError] = useState({});\n    const [loading, setLoading] = useState(false);\n    const [showLoginModal, setShowLoginModal] = useState(false);\n    const [observation, setObservation] = useState('');\n\n    const dispatch = useDispatch();\n    const { isLogged } = useSelector(state => state.auth);\n\n    useEffect(() => {\n        if (product.options) {\n            const selected = product.options.find(item => item.selected);\n\n            if (!selected && product.options.lenght > 0) {\n                product.options[0].selected = true;\n                setBasePrice(product.options[0].price);\n            }\n        }\n\n    }, []);\n\n    function updateProductPrices(base) {\n        let total = 0;\n        \n        if (base) {\n            setBasePrice(base);\n        } else {\n            base = basePrice;\n        }\n\n        if (product.groups.length > 0) {\n            for (let i in product.groups) {\n                const group = product.groups[i];\n                for (let key in group.options) {\n                    const option = group.options[key];\n                    if (option.quantity > 0) {\n                        const totalOptionPrice = option.price * option.quantity;\n                        total = total += totalOptionPrice;\n                    }\n                }\n            }\n        }\n\n        const totalPrice = (base + total) * quantity ;\n        \n        setTotalPrice(totalPrice);\n    }\n\n    const handleClose = () => {\n        setShow(false);\n    }\n\n    useEffect(() => {\n        updateProductPrices();\n    }, [quantity, basePrice, product]);\n\n    function incrementQuantity() {\n        let newQuantity = quantity;\n        newQuantity = newQuantity += 1;\n        setQuantity(newQuantity);\n    }\n    \n    function decrementQuantity() {\n        let newQuantity = quantity;\n        newQuantity = newQuantity -= 1;\n        if (newQuantity <= 0) newQuantity = 1;\n        setQuantity(newQuantity);\n    }\n\n    async function addCart(force = false) {\n        try {\n            if (setting.store_status.value !== \"1\") {\n                return;\n            }\n\n            console.log( isLogged )\n\n            if (!isLogged && !force) {\n                setShow(false);\n                return setShowLoginModal(true);\n            }\n\n            setLoading(true);\n            setError({});\n\n            await validateProductAddToCart().then(async e => {\n                const productData = {\n                    product_id: product.id,\n                    quantity,\n                    observation\n                };\n\n                productData.product_option_id = product.options.find(item => item.selected).id;\n\n                const listOptions = [];\n                product.groups.map(group => {\n                    const hasOptions = group.options.filter(op => op.quantity > 0).length;\n\n                    if (hasOptions > 0) {\n                        group.options.filter(option => option.quantity > 0).map(option => {\n                            listOptions.push({\n                                product_group_option_id: option.id,\n                                product_group_id: option.product_group_id,\n                                quantity: option.quantity\n                            });\n                        });\n\n                        return productData.options\n                    }\n                });\n\n                productData.options = listOptions;\n\n                await post('/cart', productData);\n\n                toast.success('Produto adicionado ao carrinho de compras', { position: toast.POSITION.BOTTOM_CENTER });\n\n                dispatch(loadCart());\n                dispatch(showCart(true));\n\n                setShow(false);\n                setLoading(false);\n\n            }).catch((error) => {\n                setError(error);\n                setLoading(false);\n                console.log(error);\n            });\n\n        } catch (error) {\n            console.log( error );\n        }\n    }\n\n    async function validateProductAddToCart() {\n        return new Promise((resolve, reject) => {\n            if (product.groups && product.groups.length > 0) {\n                product.groups.map(group => {\n                    if (group.options && group.options.length > 0) {\n\n                        let countSelects = 0;\n                        group.options.filter(item => item.quantity > 0).map(op => {\n                            countSelects = countSelects += op.quantity;\n                        });\n\n                        if (countSelects < group.min) {\n                            return reject({ group_id: group.id, title: group.name,  message: group.rules });\n                        }\n                    }\n                })\n            }\n\n            resolve(true);\n        });\n    }\n\n    return (\n        <>\n        {!isLogged &&\n            <LoginModal \n                showLogin={showLoginModal} \n                closeModal={() => {\n                    setShowLoginModal(false);\n                    setShow(true);\n                }}\n                onSuccess={() => {\n                    setShow(true);\n                    addCart(true);\n                }}\n            />\n        }\n\n       <Modal show={show} onHide={handleClose} animation={true} size=\"md\" className=\"modal-product-show\" centered>\n        <Modal.Header closeButton className=\"border-0\">\n            <h3>{product.name}</h3>\n        </Modal.Header>\n\n        <Modal.Body className=\"modal-body-show\">\n            <Carousel images={product.images} imageDefault={product.image_url} />\n\n            <p>{product.description}</p>\n\n            {product.options && \n                <ListGroup className=\"options mt-4 mb-4\" horizontal>\n                    {product.options.map(option =>\n                        <ListGroup.Item \n                            key={option.id} \n                            active={option.selected}\n                            onClick={() => {\n                                product.options.map(op => op.selected = false);\n                                option.selected = true;\n                                setBasePrice(option.price);\n                            }}\n                        >\n                            {option.name}\n                        </ListGroup.Item>\n                    )}\n                </ListGroup>\n            }\n            \n            <ProductGroups \n                product={product} \n                groups={product.groups} \n                error={error} \n                onChange={data => {\n                    setProduct(() => ({...product, ...data}));\n                }}\n            />\n\n            <Form.Group className=\"mt-3\">\n                <Form.Label>Observação</Form.Label>\n                <Form.Control\n                    as=\"textarea\" \n                    rows=\"2\"\n                    onChange={e => setObservation(e.target.value)}\n                    defaultValue={observation}\n                />\n            </Form.Group>\n\n        </Modal.Body>\n\n        <Modal.Footer className=\"d-flex justify-content-between align-items-center pt-0 pb-0 bg-success\">\n            <h5 className=\"price text-white pt-1\">{currency(totalPrice)}</h5>\n\n            <div className=\"d-flex\">\n                {isLogged &&\n                <>\n                    <Button className=\"btn-quantity border-0 left btn-sm\" onClick={decrementQuantity}>\n                        <i className=\"fas fa-minus-circle\"></i>\n                    </Button>\n                    <div className=\"quantity btn btn-sm border-sm pl-3 pr-3 rounded-0 text-white\">\n                        {quantity || 1}\n                    </div>\n                    <Button className=\"btn-quantity border-0 right btn-sm\" onClick={incrementQuantity}>\n                        <i className=\"fas fa-plus-circle\"></i>\n                    </Button>\n                </>\n                }\n\n                {setting.store_status.value === \"1\" &&\n                    <Button className=\"btn-quantity right btn-md ml-3 border-0 text-uppercase\" disabled={loading} onClick={() => {\n                        setShow(false);\n                     }}>\n                        \n                        <i className=\"fas fa-shopping-cart\"></i> Pedir\n\n                        {loading &&\n                            <Spinner animation=\"border\" role=\"status\">\n                                <span className=\"sr-only\">Loading...</span>\n                            </Spinner>\n                        }\n\n                    </Button>\n                }\n            </div>\n        </Modal.Footer>\n      </Modal>   \n\n      </>     \n    );\n    \n}\n  \n"]},"metadata":{},"sourceType":"module"}